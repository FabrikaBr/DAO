"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@aragon/osx-ethers"),t=require("@aragon/sdk-common"),r=require("@ethersproject/abi"),n=require("@ethersproject/bignumber"),a=require("@ethersproject/constants"),o=require("@ethersproject/contracts"),s=require("graphql-request"),i=require("@ethersproject/address"),u=require("@aragon/sdk-ipfs"),c=require("@ethersproject/providers"),p=require("@ethersproject/hash"),d=require("@ethersproject/keccak256"),l=require("@ethersproject/strings");function f(e){var t,r;function n(t,r){try{var o=e[t](r),s=o.value,i=s instanceof g;Promise.resolve(i?s.v:s).then((function(r){if(i){var u="return"===t?"return":"next";if(!s.k||r.done)return n(u,r);r=e[u](r).value}a(o.done?"return":"normal",r)}),(function(e){n("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,a){return new Promise((function(o,s){var i={key:e,arg:a,resolve:o,reject:s,next:null};r?r=r.next=i:(t=r=i,n(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function g(e,t){this.v=e,this.k=t}function h(e){var t={},r=!1;function n(t,n){return r=!0,{done:!1,value:new g(n=new Promise((function(r){r(e[t](n))})),1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function m(e){var t,r,n,a=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new v(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function v(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(v=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new v(e)}function w(e){return new g(e,0)}function y(){y=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,a){var o=Object.create((t&&t.prototype instanceof l?t:l).prototype),s=new S(a||[]);return n(o,"_invoke",{value:I(e,r,s)}),o}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function l(){}function f(){}function g(){}var h={};u(h,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(P([])));v&&v!==t&&r.call(v,o)&&(h=v);var w=g.prototype=l.prototype=Object.create(h);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var a;n(this,"_invoke",{value:function(n,o){function s(){return new t((function(a,s){!function n(a,o,s,i){var u=p(e[a],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):t.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,i)}))}i(u.arg)}(n,o,a,s)}))}return a=a?a.then(s,s):s()}})}function I(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var i=A(s,r);if(i){if(i===d)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=p(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function A(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=p(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=g,n(w,"constructor",{value:g,configurable:!0}),n(g,"constructor",{value:f,configurable:!0}),f.displayName=u(g,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,i,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},x(b.prototype),u(b.prototype,s,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var s=new b(c(t,r,n,a),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x(w),u(w,i,"Generator"),u(w,o,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=P,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var i=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(i&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;E(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function x(e){return function(){return new f(e.apply(this,arguments))}}function b(e,t,r,n,a,o,s){try{var i=e[o](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function I(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){b(o,n,a,s,i,"next",e)}function i(e){b(o,n,a,s,i,"throw",e)}s(void 0)}))}}function A(){return(A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function k(e,t){var r,n;e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r=e,n=t,(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(r,n)}function E(e,t){return t||(t=e.slice(0)),e.raw=t,e}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return S(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}f.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},f.prototype.next=function(e){return this._invoke("next",e)},f.prototype.throw=function(e){return this._invoke("throw",e)},f.prototype.return=function(e){return this._invoke("return",e)};var T,D,_,N,C,R,O,B,V,M,F,L,q,U,G=[{name:"Transfer",inputs:[{type:"address",name:"sender",indexed:!0},{type:"address",name:"receiver",indexed:!0},{type:"uint256",name:"value",indexed:!1}],anonymous:!1,type:"event"},{name:"Approval",inputs:[{type:"address",name:"owner",indexed:!0},{type:"address",name:"spender",indexed:!0},{type:"uint256",name:"value",indexed:!1}],anonymous:!1,type:"event"},{name:"transfer",outputs:[{type:"bool",name:""}],inputs:[{type:"address",name:"_to"},{type:"uint256",name:"_value"}],stateMutability:"nonpayable",type:"function"},{name:"approve",outputs:[{type:"bool",name:""}],inputs:[{type:"address",name:"_spender"},{type:"uint256",name:"_value"}],stateMutability:"nonpayable",type:"function"},{name:"symbol",outputs:[{type:"string",name:""}],inputs:[],stateMutability:"view",type:"function"},{name:"decimals",outputs:[{type:"uint256",name:""}],inputs:[],stateMutability:"view",type:"function"},{name:"balanceOf",outputs:[{type:"uint256",name:""}],inputs:[{type:"address",name:"arg0"}],stateMutability:"view",type:"function"},{name:"allowance",outputs:[{type:"uint256",name:""}],inputs:[{type:"address",name:"arg0"},{type:"address",name:"arg1"}],stateMutability:"view",type:"function"},{name:"totalSupply",outputs:[{type:"uint256",name:""}],inputs:[],stateMutability:"view",type:"function"}],$=s.gql(T||(T=E(["\n  query Dao($address: ID!) {\n    dao(id: $address){\n      id\n      subdomain\n      metadata\n      createdAt\n      plugins{\n        appliedPreparation {\n          pluginAddress\n        }\n        appliedPluginRepo {\n          subdomain\n        }\n        appliedVersion{\n          build\n          release {\n            release\n          }\n        }\n      }\n    }\n  }\n"]))),H=s.gql(D||(D=E(["\n  query Daos ($limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: Dao_orderBy!) {\n    daos(first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n      id\n      subdomain\n      metadata\n      plugins{\n        appliedPreparation {\n          pluginAddress\n        }\n        appliedPluginRepo {\n          subdomain\n        }\n        appliedVersion{\n          build\n          release {\n            release\n          }\n        }\n      }\n    }\n  }\n"]))),W=s.gql(_||(_=E(["\nquery TokenBalances($where: TokenBalance_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenBalance_orderBy!) {\n  tokenBalances (where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy) {\n    lastUpdated\n    __typename\n    ... on ERC20Balance {\n      balance\n      token {\n        name\n        decimals\n        symbol\n        id\n      }\n    }\n    ... on ERC721Balance {\n      token {\n        name\n        symbol\n        id\n      }\n    }\n    ... on NativeBalance {\n      balance\n    }\n  }\n}\n"]))),j=s.gql(N||(N=E(["\nquery TokenTransfers($where: TokenTransfer_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenTransfer_orderBy!) {\n  tokenTransfers (where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy) {\n    from\n    to\n    type\n    createdAt\n    txHash\n    proposal{\n      id\n    }\n    __typename\n    ... on ERC20Transfer {\n      amount\n      token {\n        id\n        name\n        symbol\n        decimals\n      }\n    }\n    ... on ERC721Transfer {\n      token{\n      \tid\n        name\n        symbol\n      }\n      \n    }\n    ... on NativeTransfer {\n      amount\n    }\n  }\n}\n"]))),Y=s.gql(C||(C=E(["\nquery Plugins($where: PluginRepo_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: PluginRepo_orderBy!) {\n  pluginRepos(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    subdomain\n    releases{\n      release\n      metadata\n      builds{\n        build\n      }\n    }\n  }\n}\n"]))),X=s.gql(R||(R=E(["\nquery Plugin($id: ID!) {\n  pluginRepo(id:$id){\n    subdomain\n    releases(orderBy: release, orderDirection: desc, first: 1){\n      release\n      metadata\n      builds(orderBy: build, orderDirection: desc, first: 1){\n        build\n        metadata\n      }\n    }\n  }\n}\n"]))),z=s.gql(O||(O=E(["\nquery IPlugin($address: ID!, $where: IPlugin_filter!) {\n\tiplugin(id:$address, where:$where){\n    installations(where:{state: Installed}) {\n      appliedPreparation{\n        helpers\n        pluginRepo {\n          id\n        }\n      }\n     \tappliedVersion {\n        metadata\n        build\n        release{\n          release\n        }\n      }\n    }   \n  }\n}\n"])));(B=exports.DaoCreationSteps||(exports.DaoCreationSteps={})).CREATING="creating",B.DONE="done",(V=exports.DaoSortBy||(exports.DaoSortBy={})).CREATED_AT="createdAt",V.SUBDOMAIN="subdomain",(exports.PluginSortBy||(exports.PluginSortBy={})).SUBDOMAIN="subdomain",(M=exports.DaoDepositSteps||(exports.DaoDepositSteps={})).CHECKED_ALLOWANCE="checkedAllowance",M.DEPOSITING="depositing",M.DONE="done",(exports.AssetBalanceSortBy||(exports.AssetBalanceSortBy={})).LAST_UPDATED="lastUpdated",(F=exports.TransferType||(exports.TransferType={})).DEPOSIT="deposit",F.WITHDRAW="withdraw",(exports.TransferSortBy||(exports.TransferSortBy={})).CREATED_AT="createdAt",(L=exports.SetAllowanceSteps||(exports.SetAllowanceSteps={})).SETTING_ALLOWANCE="settingAllowance",L.ALLOWANCE_SET="allowanceSet",(q=exports.PrepareUninstallationSteps||(exports.PrepareUninstallationSteps={})).PREPARING="preparing",q.DONE="done",function(e){e.DEPOSIT="Deposit",e.WITHDRAW="Withdraw"}(U||(U={}));var J,K,Z,Q,ee=new Map([[exports.TransferType.DEPOSIT,U.DEPOSIT],[exports.TransferType.WITHDRAW,U.WITHDRAW]]);(J=exports.ProposalStatus||(exports.ProposalStatus={})).ACTIVE="Active",J.PENDING="Pending",J.SUCCEEDED="Succeeded",J.EXECUTED="Executed",J.DEFEATED="Defeated",(K=exports.VoteValues||(exports.VoteValues={}))[K.ABSTAIN=1]="ABSTAIN",K[K.YES=2]="YES",K[K.NO=3]="NO",(Z=exports.VotingMode||(exports.VotingMode={})).STANDARD="Standard",Z.EARLY_EXECUTION="EarlyExecution",Z.VOTE_REPLACEMENT="VoteReplacement",(Q=exports.SubgraphVoteValues||(exports.SubgraphVoteValues={})).YES="Yes",Q.NO="No",Q.ABSTAIN="Abstain";var te,re,ne,ae,oe,se,ie=new Map([[exports.SubgraphVoteValues.YES,exports.VoteValues.YES],[exports.SubgraphVoteValues.NO,exports.VoteValues.NO],[exports.SubgraphVoteValues.ABSTAIN,exports.VoteValues.ABSTAIN]]);(exports.ProposalSortBy||(exports.ProposalSortBy={})).CREATED_AT="createdAt",(te=exports.ProposalCreationSteps||(exports.ProposalCreationSteps={})).CREATING="creating",te.DONE="done",(re=exports.VoteProposalStep||(exports.VoteProposalStep={})).VOTING="voting",re.DONE="done",(ne=exports.ExecuteProposalStep||(exports.ExecuteProposalStep={})).EXECUTING="executing",ne.DONE="done",(ae=exports.PrepareInstallationStep||(exports.PrepareInstallationStep={})).PREPARING="preparing",ae.DONE="done",(oe=exports.PermissionOperationType||(exports.PermissionOperationType={}))[oe.GRANT=0]="GRANT",oe[oe.REVOKE=1]="REVOKE",oe[oe.GRANT_WITH_CONDITION=2]="GRANT_WITH_CONDITION",(se=exports.SupportedNetwork||(exports.SupportedNetwork={})).MAINNET="homestead",se.GOERLI="goerli",se.POLYGON="matic",se.MUMBAI="maticmum";var ue,ce,pe,de=Object.values(exports.SupportedNetwork);(ue=exports.DaoRole||(exports.DaoRole={})).UPGRADE_ROLE="UPGRADE_ROLE",ue.DAO_CONFIG_ROLE="DAO_CONFIG_ROLE",ue.EXEC_ROLE="EXEC_ROLE",ue.WITHDRAW_ROLE="WITHDRAW_ROLE",ue.SET_SIGNATURE_VALIDATOR_ROLE="SET_SIGNATURE_VALIDATOR_ROLE",(ce=exports.SortDirection||(exports.SortDirection={})).ASC="asc",ce.DESC="desc",(pe=exports.TokenType||(exports.TokenType={})).NATIVE="native",pe.ERC20="erc20",pe.ERC721="erc721";var le=function(){function e(e){this.providerIdx=-1,this.context=e,this.providerIdx=Math.floor(Math.random()*e.web3Providers.length)}var r=e.prototype;return r.shiftProvider=function(){if(!this.context.web3Providers.length)throw new t.NoProviderError;if(this.context.web3Providers.length<=1)throw new t.NoNodesAvailableError("web3");this.providerIdx=(this.providerIdx+1)%this.context.web3Providers.length},r.getSigner=function(){if(!this.context.signer)throw new t.NoSignerError;return this.context.signer},r.getProvider=function(){if(!this.context.web3Providers[this.providerIdx])throw new t.NoProviderError;return this.context.web3Providers[this.providerIdx]},r.getNetworkName=function(){var e=this.context.network.name;if(!de.includes(e))throw new t.UnsupportedNetworkError(e);return e},r.getConnectedSigner=function(){var e=this.getSigner();if(!e.provider){var t=this.getProvider();e=e.connect(t)}return e},r.isUp=function(){return this.getProvider().getNetwork().then((function(){return!0})).catch((function(){return!1}))},r.ensureOnline=function(){var e=I(y().mark((function e(){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context.web3Providers.length){e.next=2;break}throw new t.NoProviderError;case 2:r=0;case 3:if(!(r<this.context.web3Providers.length)){e.next=12;break}return e.next=6,this.isUp();case 6:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:this.shiftProvider();case 9:r++,e.next=3;break;case 12:throw new t.NoNodesAvailableError("web3");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.attachContract=function(e,r){if(!e||!i.isAddress(e))throw new t.InvalidAddressError;if(!r)throw new t.InvalidContractAbiError;var n=this.getConnectedSigner();return new o.Contract(e,r,n)},r.getMaxFeePerGas=function(){return this.getConnectedSigner().getFeeData().then((function(e){if(!e.maxFeePerGas)throw new t.CannotEstimateGasError;return e.maxFeePerGas.toBigInt()}))},r.getApproximateGasFee=function(t){var r=this;return this.getMaxFeePerGas().then((function(n){var a=t*n;return{average:a*BigInt(Math.trunc(r.context.gasFeeEstimationFactor*e.PRECISION_FACTOR_BASE))/BigInt(e.PRECISION_FACTOR_BASE),max:a}}))},r.getDaoFactoryAddress=function(){if(!this.context.daoFactoryAddress)throw new t.NoDaoFactory;return this.context.daoFactoryAddress},e}();le.PRECISION_FACTOR_BASE=1e3;var fe,ge,he,me,ve,we,ye,xe=function(){function e(e){var t;this.clientIdx=-1,this.clients=[],null!=(t=e.ipfs)&&t.length&&(this.clients=e.ipfs,this.clientIdx=Math.floor(Math.random()*e.ipfs.length))}var r=e.prototype;return r.getClient=function(){if(!this.clients.length||!this.clients[this.clientIdx])throw new t.ClientNotInitializedError("ipfs");return this.clients[this.clientIdx]},r.shiftClient=function(){var e;if(!this.clients.length)throw new t.ClientNotInitializedError("ipfs");if((null==(e=this.clients)?void 0:e.length)<2)throw new t.NoNodesAvailableError("ipfs");this.clientIdx=(this.clientIdx+1)%this.clients.length},r.isUp=function(){var e;return null!=(e=this.clients)&&e.length?this.getClient().nodeInfo().then((function(){return!0})).catch((function(){return!1})):Promise.resolve(!1)},r.ensureOnline=function(){var e=I(y().mark((function e(){var r,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clients.length){e.next=2;break}throw new t.ClientNotInitializedError("ipfs");case 2:r=0;case 3:if(!(r<(null==(n=this.clients)?void 0:n.length))){e.next=12;break}return e.next=6,this.isUp();case 6:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:this.shiftClient();case 9:r++,e.next=3;break;case 12:throw new t.NoNodesAvailableError("ipfs");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getOnlineClient=function(){var e=this;return this.ensureOnline().then((function(){return e.getClient()}))},r.add=function(){var e=I(y().mark((function e(t){var r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runAndRetryHelper((function(){return r.getClient().add(t)})).then((function(e){return e.hash})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.pin=function(e){var t=this;return this.runAndRetryHelper((function(){return t.getClient().pin(e)}))},r.fetchBytes=function(e){var t=this;return this.runAndRetryHelper((function(){return t.getClient().cat(e)}))},r.runAndRetryHelper=function(e){var r=this;if(!this.clients.length)throw new t.ClientNotInitializedError("ipfs");var n=this.clients.length;return t.runAndRetry({func:e,onFail:function(e){if(e instanceof u.ClientError&&e.response.status<500)throw new t.IpfsError(e);n--,r.shiftClient()},shouldRetry:function(){return n>0}})},r.fetchString=function(e){return this.fetchBytes(e).then((function(e){return(new TextDecoder).decode(e)})).catch((function(e){throw new t.DataDecodingError(e.message)}))},e}(),be=s.gql(fe||(fe=E(["\n{\n  _meta{\n    deployment\n  }\n}\n"]))),Ie=function(){function e(e){var t;this.clientIdx=-1,this.clients=[],null!=(t=e.graphql)&&t.length&&(this.clients=e.graphql,this.clientIdx=Math.floor(Math.random()*e.graphql.length))}var r=e.prototype;return r.getClient=function(){if(!this.clients.length||!this.clients[this.clientIdx])throw new t.ClientNotInitializedError("graphql");return this.clients[this.clientIdx]},r.shiftClient=function(){if(!this.clients.length)throw new t.ClientNotInitializedError("graphql");if(this.clients.length<2)throw new t.NoNodesAvailableError("graphql");this.clientIdx=(this.clientIdx+1)%this.clients.length},r.isUp=function(){return this.getClient().request(be).then((function(e){var t;return!(null==(t=e._meta)||!t.deployment)})).catch((function(){return!1}))},r.ensureOnline=function(){var e=I(y().mark((function e(){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clients.length){e.next=2;break}throw new t.ClientNotInitializedError("graphql");case 2:r=0;case 3:if(!(r<this.clients.length)){e.next=12;break}return e.next=6,this.isUp();case 6:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:this.shiftClient();case 9:r++,e.next=3;break;case 12:throw new t.NoNodesAvailableError("graphql");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.request=function(e){var r=this,n=e.query,a=e.params,o=e.name;if(!this.clients.length)throw new t.ClientNotInitializedError("graphql");var i=this.clients.length;return t.runAndRetry({func:function(){return r.getClient().request(n,a)},onFail:function(e){if(e instanceof s.ClientError&&e.response.status<500)throw new t.GraphQLError(o||"",e);i--,r.shiftClient()},shouldRetry:function(){return i>0}})},e}(),Ae=function(e){this.web3=new le(e),this.ipfs=new xe(e),this.graphql=new Ie(e)},ke={title:"(unsupported metadata link)",summary:"(the link to the metadata is not supported)",description:"(the link to the metadata is not supported)",resources:[]},Ee={title:"(the proposal has no metadata)",summary:"(the current proposal does not have any content defined)",description:"(the current proposal does not have any content defined)",resources:[]},Se={title:"(unavailable metadata)",summary:"(the proposal metadata is not available)",description:"(the proposal metadata is not available)",resources:[]},Pe=function(e){return"https://subgraph.satsuma-prod.com/qHR2wGfc5RLi6/aragon/osx-"+Te[e]+"/api"},Te=((ge={})[exports.SupportedNetwork.MAINNET]="mainnet",ge[exports.SupportedNetwork.GOERLI]="goerli",ge[exports.SupportedNetwork.POLYGON]="polygon",ge[exports.SupportedNetwork.MUMBAI]="mumbai",ge),De=((he={})[exports.SupportedNetwork.MAINNET]=[{url:Pe(exports.SupportedNetwork.MAINNET)}],he[exports.SupportedNetwork.GOERLI]=[{url:Pe(exports.SupportedNetwork.GOERLI)}],he[exports.SupportedNetwork.POLYGON]=[{url:Pe(exports.SupportedNetwork.POLYGON)}],he[exports.SupportedNetwork.MUMBAI]=[{url:Pe(exports.SupportedNetwork.MUMBAI)}],he),_e=[{url:"https://ipfs-0.aragon.network",headers:{"X-API-KEY":"b477RhECf8s8sdM7XrkLBs2wHc4kCMwpbcFC55Kt"}},{url:"https://ipfs-1.aragon.network",headers:{"X-API-KEY":"b477RhECf8s8sdM7XrkLBs2wHc4kCMwpbcFC55Kt"}}],Ne=[{url:"https://testing-ipfs-0.aragon.network",headers:{"X-API-KEY":"b477RhECf8s8sdM7XrkLBs2wHc4kCMwpbcFC55Kt"}}],Ce=((me={})[exports.SupportedNetwork.MAINNET]=_e,me[exports.SupportedNetwork.GOERLI]=Ne,me[exports.SupportedNetwork.POLYGON]=_e,me[exports.SupportedNetwork.MUMBAI]=Ne,me),Re=((ve={})[exports.SupportedNetwork.MAINNET]={daoFactory:e.activeContractsList.mainnet.DAOFactory,pluginSetupProcessor:e.activeContractsList.mainnet.PluginRepoFactory,multisigRepo:e.activeContractsList.mainnet["multisig-repo"],adminRepo:e.activeContractsList.mainnet["admin-repo"],addresslistVotingRepo:e.activeContractsList.mainnet["address-list-voting-repo"],tokenVotingRepo:e.activeContractsList.mainnet["token-voting-repo"],multisigSetup:e.activeContractsList.mainnet.MultisigSetup,adminSetup:e.activeContractsList.mainnet.AdminSetup,addresslistVotingSetup:e.activeContractsList.mainnet.AddresslistVotingSetup,tokenVotingSetup:e.activeContractsList.mainnet.TokenVotingSetup},ve[exports.SupportedNetwork.GOERLI]={daoFactory:e.activeContractsList.goerli.DAOFactory,pluginSetupProcessor:e.activeContractsList.goerli.PluginSetupProcessor,multisigRepo:e.activeContractsList.goerli["multisig-repo"],adminRepo:e.activeContractsList.goerli["admin-repo"],addresslistVotingRepo:e.activeContractsList.goerli["address-list-voting-repo"],tokenVotingRepo:e.activeContractsList.goerli["token-voting-repo"],multisigSetup:e.activeContractsList.goerli.MultisigSetup,adminSetup:e.activeContractsList.goerli.AdminSetup,addresslistVotingSetup:e.activeContractsList.goerli.AddresslistVotingSetup,tokenVotingSetup:e.activeContractsList.goerli.TokenVotingSetup},ve[exports.SupportedNetwork.MUMBAI]={daoFactory:e.activeContractsList.mumbai.DAOFactory,pluginSetupProcessor:e.activeContractsList.mumbai.PluginSetupProcessor,multisigRepo:e.activeContractsList.mumbai["multisig-repo"],adminRepo:e.activeContractsList.mumbai["admin-repo"],addresslistVotingRepo:e.activeContractsList.mumbai["address-list-voting-repo"],tokenVotingRepo:e.activeContractsList.mumbai["token-voting-repo"],multisigSetup:e.activeContractsList.mumbai.MultisigSetup,adminSetup:e.activeContractsList.mumbai.AdminSetup,addresslistVotingSetup:e.activeContractsList.mumbai.AddresslistVotingSetup,tokenVotingSetup:e.activeContractsList.mumbai.TokenVotingSetup,ensRegistry:e.activeContractsList.mumbai.ENSRegistry},ve[exports.SupportedNetwork.POLYGON]={daoFactory:e.activeContractsList.polygon.DAOFactory,pluginSetupProcessor:e.activeContractsList.polygon.PluginSetupProcessor,multisigRepo:e.activeContractsList.polygon["multisig-repo"],adminRepo:e.activeContractsList.polygon["admin-repo"],addresslistVotingRepo:e.activeContractsList.polygon["address-list-voting-repo"],tokenVotingRepo:e.activeContractsList.polygon["token-voting-repo"],multisigSetup:e.activeContractsList.polygon.MultisigSetup,adminSetup:e.activeContractsList.polygon.AdminSetup,addresslistVotingSetup:e.activeContractsList.polygon.AddresslistVotingSetup,tokenVotingSetup:e.activeContractsList.polygon.TokenVotingSetup,ensRegistry:e.activeContractsList.polygon.ENSRegistry},ve),Oe=["https:"];"undefined"!=typeof process&&null!=(we=process)&&null!=(ye=we.env)&&ye.TESTING&&Oe.push("http:");var Be=function(){function e(e){this.state={},this.overriden={daoFactoryAddress:!1,ensRegistryAddress:!1,gasFeeEstimationFactor:!1,ipfsNodes:!1,graphqlNodes:!1};var t=Object.assign({network:"mainnet"},e);this.set(t)}var r,n,a=e.prototype;return a.set=function(t){var r,n;t.network&&(this.state.network=e.resolveNetwork(t.network,t.ensRegistryAddress),this.setNetworkDefaults()),t.signer&&(this.state.signer=t.signer),(t.web3Providers||Array.isArray(t.web3Providers)&&t.web3Providers.length)&&(this.state.web3Providers=e.resolveWeb3Providers(t.web3Providers,this.state.network)),null!=(r=t.graphqlNodes)&&r.length&&(this.state.graphql=e.resolveGraphql(t.graphqlNodes),this.overriden.graphqlNodes=!0),null!=(n=t.ipfsNodes)&&n.length&&(this.state.ipfs=e.resolveIpfs(t.ipfsNodes),this.overriden.ipfsNodes=!0),t.daoFactoryAddress&&(this.state.daoFactoryAddress=t.daoFactoryAddress,this.overriden.daoFactoryAddress=!0),t.ensRegistryAddress&&(this.state.ensRegistryAddress=t.ensRegistryAddress,this.overriden.ensRegistryAddress=!0),t.gasFeeEstimationFactor&&(this.state.gasFeeEstimationFactor=e.resolveGasFeeEstimationFactor(t.gasFeeEstimationFactor),this.overriden.gasFeeEstimationFactor=!0)},a.setNetworkDefaults=function(){var r,n,a=this.network.name;if(null==(r=De[a])||!r.length||null==(n=Ce[a])||!n.length||!Re[a])throw new t.UnsupportedNetworkError(a);if(this.overriden.graphqlNodes||(this.state.graphql=e.resolveGraphql(De[a])),this.overriden.ipfsNodes||(this.state.ipfs=e.resolveIpfs(Ce[a])),this.overriden.daoFactoryAddress||(this.state.daoFactoryAddress=Re[a].daoFactory),!this.overriden.ensRegistryAddress){var o=Re[a].ensRegistry;o||(o=this.network.ensAddress),this.state.ensRegistryAddress=o}this.overriden.gasFeeEstimationFactor||(this.state.gasFeeEstimationFactor=.625)},e.resolveNetwork=function(e,r){var n=c.getNetwork(e),a=n.name;if(!de.includes(a))throw new t.UnsupportedNetworkError(a);if(r){if(!i.isAddress(r))throw new t.InvalidAddressError;n.ensAddress=r}if(!n.ensAddress){var o=Re[a].ensRegistry;if(!o)throw new t.UnsupportedNetworkError(a);n.ensAddress=o}return n},e.resolveWeb3Providers=function(e,r){if(Array.isArray(e))return e.map((function(e){if("string"==typeof e){var n=new URL(e);if(!Oe.includes(n.protocol))throw new t.UnsupportedProtocolError(n.protocol);return new c.JsonRpcProvider(n.href,r)}return e}));if("string"==typeof e){var n=new URL(e);if(!Oe.includes(n.protocol))throw new t.UnsupportedProtocolError(n.protocol);return[new c.JsonRpcProvider(n.href,r)]}return[e]},e.resolveIpfs=function(e){var r=[];return e.forEach((function(e){var n=new URL(e.url);if(!Oe.includes(n.protocol))throw new t.UnsupportedProtocolError(n.protocol);r.push(new u.Client(n,e.headers))})),r},e.resolveGraphql=function(e){var r=[];return e.forEach((function(e){var n=new URL(e.url);if(!Oe.includes(n.protocol))throw new t.UnsupportedProtocolError(n.protocol);r.push(new s.GraphQLClient(n.href))})),r},e.resolveGasFeeEstimationFactor=function(e){if(e<0||e>1)throw new Error("Gas estimation factor value should be a number between 0 and 1");return e},r=e,(n=[{key:"network",get:function(){return this.state.network}},{key:"ensRegistryAddress",get:function(){return this.state.ensRegistryAddress}},{key:"signer",get:function(){return this.state.signer}},{key:"web3Providers",get:function(){return this.state.web3Providers||[]}},{key:"daoFactoryAddress",get:function(){return this.state.daoFactoryAddress}},{key:"gasFeeEstimationFactor",get:function(){return this.state.gasFeeEstimationFactor}},{key:"ipfs",get:function(){return this.state.ipfs}},{key:"graphql",get:function(){return this.state.graphql}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?a:String(a),n)}var a}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(),Ve=function(e){function t(t){return e.call(this,t)||this}return k(t,e),t.fromContext=function(e){var r=new t({});return Object.assign(r,e),r},t.prototype.set=function(t){e.prototype.set.call(this,t)},t}(Be);function Me(e){var t=new Date,r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));return e.executed?exports.ProposalStatus.EXECUTED:r>=t?exports.ProposalStatus.PENDING:e.potentiallyExecutable||e.earlyExecutable?exports.ProposalStatus.SUCCEEDED:n>=t?exports.ProposalStatus.ACTIVE:exports.ProposalStatus.DEFEATED}function Fe(e){var t={},r=Math.round((new Date).getTime()/1e3).toString();switch(e){case exports.ProposalStatus.PENDING:t={startDate_gte:r};break;case exports.ProposalStatus.ACTIVE:t={startDate_lt:r,endDate_gte:r,executed:!1};break;case exports.ProposalStatus.EXECUTED:t={executed:!0};break;case exports.ProposalStatus.SUCCEEDED:t={potentiallyExecutable:!0,endDate_lt:r};break;case exports.ProposalStatus.DEFEATED:t={potentiallyExecutable:!1,endDate_lt:r,executed:!1};break;default:throw new Error("invalid proposal status")}return t}function Le(e,t,r){return e.logs.find((function(e){return e.topics[0]===p.id(t.getEvent(r).format("sighash"))}))}function qe(e){switch(e){case exports.VotingMode.STANDARD:return 0;case exports.VotingMode.EARLY_EXECUTION:return 1;case exports.VotingMode.VOTE_REPLACEMENT:return 2;default:throw new t.InvalidVotingModeError}}function Ue(e){switch(e){case 0:return exports.VotingMode.STANDARD;case 1:return exports.VotingMode.EARLY_EXECUTION;case 2:return exports.VotingMode.VOTE_REPLACEMENT;default:throw new t.InvalidVotingModeError}}function Ge(r){var n,a=e.MajorityVotingBase__factory.createInterface(),o=t.bytesToHex(r),s=a.getFunction("updateVotingSettings");return{votingMode:Ue((n=a.decodeFunctionData(s,o))[0][0]),supportThreshold:t.decodeRatio(n[0][1],6),minParticipation:t.decodeRatio(n[0][2],6),minDuration:n[0][3].toNumber(),minProposerVotingPower:BigInt(n[0][4])}}function $e(r){var n=e.MajorityVotingBase__factory.createInterface(),a=He(r),o=n.encodeFunctionData("updateVotingSettings",[a]);return t.hexToBytes(o)}function He(e){return{votingMode:n.BigNumber.from(qe(e.votingMode||exports.VotingMode.STANDARD)),supportThreshold:t.encodeRatio(e.supportThreshold,6),minParticipation:t.encodeRatio(e.minParticipation,6),minDuration:n.BigNumber.from(e.minDuration),minProposerVotingPower:n.BigNumber.from(e.minProposerVotingPower||0)}}function We(e,n){var a=t.bytesToHex(e);return new r.Interface(n).getFunction(a.substring(0,10))}var je={UPGRADE_PERMISSION:"UPGRADE_PERMISSION",SET_METADATA_PERMISSION:"SET_METADATA_PERMISSION",EXECUTE_PERMISSION:"EXECUTE_PERMISSION",WITHDRAW_PERMISSION:"WITHDRAW_PERMISSION",SET_SIGNATURE_VALIDATOR_PERMISSION:"SET_SIGNATURE_VALIDATOR_PERMISSION",SET_TRUSTED_FORWARDER_PERMISSION:"SET_TRUSTED_FORWARDER_PERMISSION",ROOT_PERMISSION:"ROOT_PERMISSION",CREATE_VERSION_PERMISSION:"CREATE_VERSION_PERMISSION",REGISTER_PERMISSION:"REGISTER_PERMISSION",REGISTER_DAO_PERMISSION:"REGISTER_DAO_PERMISSION",REGISTER_ENS_SUBDOMAIN_PERMISSION:"REGISTER_ENS_SUBDOMAIN_PERMISSION",MINT_PERMISSION:"MINT_PERMISSION",MERKLE_MINT_PERMISSION:"MERKLE_MINT_PERMISSION",MODIFY_ALLOWLIST_PERMISSION:"MODIFY_ALLOWLIST_PERMISSION",SET_CONFIGURATION_PERMISSION:"SET_CONFIGURATION_PERMISSION"},Ye=Object.entries(je).reduce((function(e,t){var r;return A({},e,((r={})[t[0]+"_ID"]=d.keccak256(l.toUtf8Bytes(t[1])),r))}),{});function Xe(e){var t;return[e.daoAddressOrEns,e.amount,null!=(t=null==e?void 0:e.tokenAddress)?t:a.AddressZero,""]}function ze(e,t){return{address:e.id,ensDomain:e.subdomain+".dao.eth",metadata:{name:t.name,description:t.description,avatar:t.avatar||void 0,links:t.links},creationDate:new Date(1e3*parseInt(e.createdAt)),plugins:e.plugins.map((function(e){return{id:e.appliedPluginRepo.subdomain+".plugin.dao.eth",release:e.appliedVersion.release.release,build:e.appliedVersion.build,instanceAddress:e.appliedPreparation.pluginAddress}}))}}function Je(e,t){return{address:e.id,ensDomain:e.subdomain+".dao.eth",metadata:{name:t.name,description:t.description,avatar:t.avatar||void 0},plugins:e.plugins.map((function(e){return{id:e.appliedPluginRepo.subdomain+".plugin.dao.eth",release:e.appliedVersion.release.release,build:e.appliedVersion.build,instanceAddress:e.appliedPreparation.pluginAddress}}))}}function Ke(e){var t=new Date(1e3*parseInt(e.lastUpdated));return"NativeBalance"===e.__typename?{type:exports.TokenType.NATIVE,balance:BigInt(e.balance),updateDate:t}:"ERC721Balance"===e.__typename?{type:exports.TokenType.ERC721,name:e.token.name,symbol:e.token.symbol,updateDate:t,address:e.token.id}:{type:exports.TokenType.ERC20,address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals,balance:BigInt(e.balance),updateDate:t}}function Ze(e){var t,r,n,a=new Date(1e3*parseInt(e.createdAt));return"NativeTransfer"===e.__typename?e.type===U.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:exports.TokenType.NATIVE,amount:BigInt(e.amount),creationDate:a,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:exports.TokenType.NATIVE,amount:BigInt(e.amount),creationDate:a,transactionId:e.txHash,proposalId:(null==(t=e.proposal)?void 0:t.id)||"",to:e.to,from:e.from}:"ERC721Transfer"===e.__typename?e.type===U.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:exports.TokenType.ERC721,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol},creationDate:a,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:exports.TokenType.ERC721,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol},creationDate:a,transactionId:e.txHash,to:e.to,from:e.from,proposalId:(null==(r=e.proposal)?void 0:r.id)||""}:e.type===U.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:exports.TokenType.ERC20,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals},amount:BigInt(e.amount),creationDate:a,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:exports.TokenType.ERC20,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals},amount:BigInt(e.amount),creationDate:a,transactionId:e.txHash,to:e.to,from:e.from,proposalId:(null==(n=e.proposal)?void 0:n.id)||""}}function Qe(e,t){return{release:e.release,currentBuild:Math.max.apply(Math,e.builds.map((function(e){return e.build}))),metadata:t}}function et(e,t){return{address:e.id,subdomain:e.subdomain,releases:t}}function tt(e,t,r){var n,a,o,s,i,u;return{address:e.id,subdomain:e.subdomain,current:{build:{metadata:r,number:null==(n=e.releases)||null==(a=n[0])||null==(o=a.builds)||null==(s=o[0])?void 0:s.build},release:{metadata:t,number:null==(i=e.releases)||null==(u=i[0])?void 0:u.release}}}}function rt(e){var t=e[1];return{helpersHash:t.helpersHash,permissions:t.permissions,versionTag:t.pluginSetupRef.versionTag,pluginAddress:t.plugin,pluginRepo:t.pluginSetupRef.pluginSetupRepo}}function nt(e){return[e.where,e.who,d.keccak256(l.toUtf8Bytes(e.permission))]}function at(e){var t;return{where:e[0],who:e[1],permissionId:e[2],permission:(null==(t=Object.keys(Ye).find((function(t){return Ye[t]===e[2]})))?void 0:t.replace(/_ID$/,""))||""}}function ot(e,t,r,n){if(n===exports.TokenType.ERC20)return{type:exports.TokenType.ERC20,tokenAddress:e,recipientAddressOrEns:r[0],amount:BigInt(r[1])};throw new Error("not implemented")}Object.freeze(je),Object.freeze(Ye);var st,it,ut,ct,pt=[new o.Contract(a.AddressZero,G).interface.getFunction("transfer").format("minimal"),e.DAO__factory.createInterface().getFunction("grant").format("minimal"),e.DAO__factory.createInterface().getFunction("grantWithCondition").format("minimal"),e.DAO__factory.createInterface().getFunction("revoke").format("minimal"),e.DAO__factory.createInterface().getFunction("setMetadata").format("minimal"),e.DAO__factory.createInterface().getFunction("setDaoURI").format("minimal"),e.DAO__factory.createInterface().getFunction("registerStandardCallback").format("minimal"),e.DAO__factory.createInterface().getFunction("setSignatureValidator").format("minimal"),e.DAO__factory.createInterface().getFunction("upgradeTo").format("minimal"),e.DAO__factory.createInterface().getFunction("upgradeToAndCall").format("minimal")],dt={name:"(unsupported metadata link)",description:"(the metadata link is not supported)",links:[]},lt={name:"(the DAO has no metadata)",description:"(the DAO did not define any content)",links:[]},ft={name:"(unavailable metadata)",description:"(the DAO metadata is not available)",links:[]},gt={name:"(unsupported metadata link)",description:"(the metadata link is not supported)",images:{}},ht={name:"(the release has no metadata)",description:"(the release did not define any content)",images:{}},mt={name:"(unavailable metadata)",description:"(the release metadata is not available)",images:{}},vt={ui:"",change:"(unsupported metadata link)",pluginSetupABI:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}},wt={ui:"",change:"(the build has no metadata)",pluginSetupABI:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}},yt={ui:"",change:"(unavailable metadata)",pluginSetupABI:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}},xt=function(s){function u(){return s.apply(this,arguments)||this}k(u,s);var c=u.prototype;return c.createDao=function(r){var n=this;return x(y().mark((function o(){var s,i,u,c,d,f,g,h,m,v,x,b,I,A,k,E,S,T,D,_,N,C,R;return y().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=n.web3.getConnectedSigner(),!r.ensSubdomain||r.ensSubdomain.match(/^[a-z0-9\-]+$/)){o.next=3;break}throw new t.InvalidEnsError;case 3:c=e.DAOFactory__factory.connect(n.web3.getDaoFactoryAddress(),u),d=[],f=P(r.plugins);case 6:if((g=f()).done){o.next=18;break}return m=e.PluginRepo__factory.connect((h=g.value).id,u),o.next=11,w(m.latestRelease());case 11:return v=o.sent,o.next=14,w(m["getLatestVersion(uint8)"](v));case 14:d.push({pluginSetupRef:{pluginSetupRepo:m.address,versionTag:o.sent.tag},data:h.data});case 16:o.next=6;break;case 18:return o.next=20,w(c.pluginSetupProcessor());case 20:return x=e.PluginSetupProcessor__factory.connect(o.sent,u),b=!1,o.next=25,w(c.daoBase());case 25:I=o.sent,A=0,k=d;case 27:if(!(A<k.length)){o.next=39;break}return E=k[A],o.next=31,w(x.callStatic.prepareInstallation(I,E));case 31:if(!o.sent[1].permissions.find((function(e){return e.permissionId===Ye.EXECUTE_PERMISSION_ID}))){o.next=36;break}return b=!0,o.abrupt("break",39);case 36:A++,o.next=27;break;case 39:if(b){o.next=41;break}throw new t.MissingExecPermissionError;case 41:return o.next=43,w(c.connect(u).createDao({subdomain:r.ensSubdomain,metadata:l.toUtf8Bytes(r.metadataUri),daoURI:r.daoUri||"",trustedForwarder:r.trustedForwarder||a.AddressZero},d));case 43:return S=o.sent,o.next=46,{key:exports.DaoCreationSteps.CREATING,txHash:S.hash};case 46:return o.next=48,w(S.wait());case 48:if(T=o.sent,D=e.DAORegistry__factory.createInterface(),_=null==(s=T.logs)?void 0:s.find((function(e){return e.topics[0]===p.id(D.getEvent("DAORegistered").format("sighash"))}))){o.next=53;break}throw new Error("Failed to create DAO");case 53:if(N=e.PluginSetupProcessor__factory.createInterface(),C=null==(i=T.logs)?void 0:i.filter((function(e){return e.topics[0]===p.id(N.getEvent("InstallationApplied").format("sighash"))})),(R=D.parseLog(_)).args.dao){o.next=58;break}throw new Error("Failed to create DAO");case 58:return o.next=60,{key:exports.DaoCreationSteps.DONE,address:R.args.dao,pluginAddresses:C.map((function(e){return N.parseLog(e).args[1]}))};case 60:case"end":return o.stop()}}),o)})))()},c.pinMetadata=function(){var e=I(y().mark((function e(r){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(r));case 3:return n=e.sent,e.next=6,this.ipfs.pin(n);case 6:return e.abrupt("return","ipfs://"+n);case 9:throw e.prev=9,e.t0=e.catch(0),new t.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),c.deposit=function(r){var n=this;return x(y().mark((function s(){var i,u,c,p,d,l,f,g,v,x,b,I,A,k;return y().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(i=n.web3.getConnectedSigner(),r.type===exports.TokenType.NATIVE||r.type===exports.TokenType.ERC20){s.next=3;break}throw new Error("Please, use the token's transfer function directly");case 3:if(u=Xe(r),c=u[0],p=u[1],l=u[3],!(d=u[2])||d===a.AddressZero){s.next=20;break}return f=new o.Contract(d,G,i),s.t0=w,s.t1=f,s.next=10,w(i.getAddress());case 10:return s.t2=s.sent,s.t3=c,s.t4=s.t1.allowance.call(s.t1,s.t2,s.t3),s.next=15,(0,s.t0)(s.t4);case 15:return g=s.sent,s.next=18,{key:exports.DaoDepositSteps.CHECKED_ALLOWANCE,allowance:g.toBigInt()};case 18:if(!g.lt(r.amount)){s.next=20;break}return s.delegateYield(h(m(n.setAllowance({amount:r.amount,spender:c,tokenAddress:d}))),"t5",20);case 20:return v=e.DAO__factory.connect(c,i),x={},d===a.AddressZero&&(x.value=p),s.next=25,w(v.deposit(d,p,l,x));case 25:return b=s.sent,s.next=28,{key:exports.DaoDepositSteps.DEPOSITING,txHash:b.hash};case 28:return s.next=30,w(b.wait());case 30:if(I=Le(s.sent,v.interface,"Deposited")){s.next=34;break}throw new t.FailedDepositError;case 34:if(A=e.DAO__factory.createInterface(),k=A.parseLog(I),!p.toString()!==k.args.amount){s.next=38;break}throw new t.AmountMismatchError(p,k.args.amount.toBigInt());case 38:return s.next=40,{key:exports.DaoDepositSteps.DONE,amount:p};case 40:case"end":return s.stop()}}),s)})))()},c.setAllowance=function(e){var r=this;return x(y().mark((function a(){var s,i,u,c,p;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=r.web3.getConnectedSigner(),i=new o.Contract(e.tokenAddress,G,s),a.next=4,w(i.approve(e.spender,e.amount));case 4:return u=a.sent,a.next=7,{key:exports.SetAllowanceSteps.SETTING_ALLOWANCE,txHash:u.hash};case 7:return a.next=9,w(u.wait());case 9:if(c=Le(a.sent,i.interface,"Approval")){a.next=13;break}throw new t.UpdateAllowanceError;case 13:if((p=c.data)&&!n.BigNumber.from(e.amount).gt(n.BigNumber.from(p))){a.next=16;break}throw new t.UpdateAllowanceError;case 16:return a.next=18,{key:exports.SetAllowanceSteps.ALLOWANCE_SET,allowance:e.amount};case 18:case"end":return a.stop()}}),a)})))()},c.prepareUninstallation=function(n){var a=this;return x(y().mark((function o(){var s,i,u,c,p,d,l,f,g,h,m,v;return y().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s=a.web3.getConnectedSigner(),i=a.web3.getNetworkName(),o.next=4,w(a.graphql.request({query:z,params:{address:n.pluginAddress.toLowerCase(),where:{dao:n.daoAddressOrEns}},name:"plugin"}));case 4:if(c=o.sent.iplugin.installations[void 0===(u=n.pluginInstallationIndex)?0:u]){o.next=10;break}throw new t.InstallationNotFoundError;case 10:return l=r.defaultAbiCoder.encode(void 0===(d=n.uninstallationAbi)?[]:d,void 0===(p=n.uninstallationParams)?[]:p),f=e.PluginSetupProcessor__factory.connect(Re[i].pluginSetupProcessor,s),o.next=15,w(f.prepareUninstallation(n.daoAddressOrEns,{pluginSetupRef:{pluginSetupRepo:c.appliedPreparation.pluginRepo.id,versionTag:{build:c.appliedVersion.build,release:c.appliedVersion.release.release}},setupPayload:{plugin:n.pluginAddress,currentHelpers:c.appliedPreparation.helpers,data:l}}));case 15:return g=o.sent,o.next=18,{key:exports.PrepareUninstallationSteps.PREPARING,txHash:g.hash};case 18:return o.next=20,w(g.wait());case 20:if(h=Le(o.sent,f.interface,"UninstallationPrepared")){o.next=24;break}throw new t.PluginUninstallationPreparationError;case 24:if(m=f.interface.parseLog(h),v=m.args.permissions){o.next=28;break}throw new t.PluginUninstallationPreparationError;case 28:return o.next=30,{key:exports.PrepareUninstallationSteps.DONE,permissions:v.map((function(e){return{operation:e.operation,where:e.where,who:e.who,permissionId:e.permissionId}})),pluginRepo:c.appliedPreparation.pluginRepo.id,pluginAddress:n.pluginAddress,versionTag:{build:c.appliedVersion.build,release:c.appliedVersion.release.release}};case 30:case"end":return o.stop()}}),o)})))()},c.hasPermission=function(){var t=I(y().mark((function t(r){var n,a;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.web3.getConnectedSigner(),a=e.DAO__factory.connect(r.daoAddressOrEns,n),t.abrupt("return",a.hasPermission(r.where,r.who,p.id(r.permission),r.data||new Uint8Array([])));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),c.getDao=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(n=r)){e.next=19;break}return e.next=4,this.web3.ensureOnline();case 4:if(a=this.web3.getProvider()){e.next=7;break}throw new t.NoProviderError;case 7:return e.prev=7,e.next=10,a.resolveName(n);case 10:if(o=e.sent){e.next=13;break}throw new t.InvalidAddressOrEnsError;case 13:n=o.toLowerCase(),e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(7),new t.InvalidAddressOrEnsError(e.t0);case 19:return s=$,u={address:n},e.next=24,this.graphql.request({query:s,params:u,name:"DAO"});case 24:if(c=e.sent.dao){e.next=30;break}return e.abrupt("return",null);case 30:if(c.metadata){e.next=32;break}return e.abrupt("return",ze(c,lt));case 32:return e.prev=32,p=t.resolveIpfsCid(c.metadata),e.next=36,this.ipfs.fetchString(p);case 36:return d=JSON.parse(e.sent),e.abrupt("return",ze(c,d));case 41:if(e.prev=41,e.t1=e.catch(32),!(e.t1 instanceof t.InvalidCidError)){e.next=45;break}return e.abrupt("return",ze(c,dt));case 45:return e.abrupt("return",ze(c,ft));case 46:case"end":return e.stop()}}),e,this,[[7,16],[32,41]])})));return function(t){return e.apply(this,arguments)}}(),c.getDaos=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u,c,p,d=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.limit,a=r.skip,s=void 0===(o=r.direction)?exports.SortDirection.ASC:o,u=void 0===(i=r.sortBy)?exports.DaoSortBy.CREATED_AT:i,c=H,p={limit:void 0===n?10:n,skip:void 0===a?0:a,direction:s,sortBy:u},e.next=6,this.graphql.request({query:c,params:p,name:"DAOs"});case 6:return e.abrupt("return",Promise.all(e.sent.daos.map(function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.metadata){e.next=2;break}return e.abrupt("return",Je(r,lt));case 2:return e.prev=2,n=t.resolveIpfsCid(r.metadata),e.next=6,d.ipfs.fetchString(n);case 6:return a=JSON.parse(e.sent),e.abrupt("return",Je(r,a));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof t.InvalidCidError)){e.next=15;break}return e.abrupt("return",Je(r,dt));case 15:return e.abrupt("return",Je(r,ft));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.getDaoBalances=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d,l,f,g,h,m,v,w;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(n=r.limit)?10:n,s=void 0===(o=r.skip)?0:o,c=void 0===(u=r.direction)?exports.SortDirection.ASC:u,d=void 0===(p=r.sortBy)?exports.AssetBalanceSortBy.LAST_UPDATED:p,l={},!(f=r.daoAddressOrEns)){e.next=17;break}if(i.isAddress(f)){e.next=16;break}return e.next=7,this.web3.ensureOnline();case 7:if(g=this.web3.getProvider()){e.next=10;break}throw new t.NoProviderError;case 10:return e.next=12,g.resolveName(f);case 12:if(h=e.sent){e.next=15;break}throw new t.InvalidAddressOrEnsError;case 15:f=h;case 16:l={dao:f.toLowerCase()};case 17:return m=W,v={where:l,limit:a,skip:s,direction:c,sortBy:d},e.next=22,this.graphql.request({query:m,params:v,name:"dao balances"});case 22:if(0!==(w=e.sent.tokenBalances).length){e.next=26;break}return e.abrupt("return",[]);case 26:return e.abrupt("return",Promise.all(w.map((function(e){return Ke(e)}))));case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.getDaoTransfers=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d,l,f,g,h,m,v,w,x;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.type,o=void 0===(a=r.limit)?10:a,u=void 0===(s=r.skip)?0:s,p=void 0===(c=r.direction)?exports.SortDirection.ASC:c,l=void 0===(d=r.sortBy)?exports.TransferSortBy.CREATED_AT:d,f={},!(g=r.daoAddressOrEns)){e.next=23;break}if(i.isAddress(g)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(h=this.web3.getProvider()){e.next=10;break}throw new t.NoProviderError;case 10:return e.prev=10,e.next=13,h.resolveName(g);case 13:if(m=e.sent){e.next=16;break}throw new t.InvalidAddressOrEnsError;case 16:g=m,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new t.InvalidAddressOrEnsError(e.t0);case 22:f={dao:g.toLowerCase()};case 23:return n&&(f=A({},f,{type:ee.get(n)})),v=j,w={where:f,limit:o,skip:u,direction:p,sortBy:l},e.next=29,this.graphql.request({query:v,params:w,name:"dao transfers"});case 29:if(x=e.sent.tokenTransfers){e.next=33;break}return e.abrupt("return",null);case 33:return e.abrupt("return",Promise.all(x.map((function(e){return Ze(e)}))));case 34:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),c.getPlugins=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u,c,p,d,l,f,g=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(n=void 0===r?{}:r).limit,o=n.skip,i=void 0===(s=n.direction)?exports.SortDirection.ASC:s,c=void 0===(u=n.sortBy)?exports.PluginSortBy.SUBDOMAIN:u,d={},(p=n.subdomain)&&(d={subdomain_contains_nocase:p}),l=Y,f={where:d,limit:void 0===a?10:a,skip:void 0===o?0:o,direction:i,sortBy:c},e.next=8,this.graphql.request({query:l,params:f,name:"plugin repos"});case 8:return e.abrupt("return",Promise.all(e.sent.pluginRepos.map(function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u,c;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=P(r.releases);case 2:if((o=a()).done){e.next=25;break}if(i=void 0,(s=o.value).metadata){e.next=9;break}i=ht,e.next=22;break;case 9:return e.prev=9,u=t.resolveIpfsCid(s.metadata),e.next=13,g.ipfs.fetchString(u);case 13:c=JSON.parse(e.sent),i=c,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(9),i=mt,e.t0 instanceof t.InvalidCidError&&(i=gt);case 22:n=[].concat(n,[Qe(s,i)]);case 23:e.next=2;break;case 25:return e.abrupt("return",et(r,n));case 26:case"end":return e.stop()}}),e,null,[[9,18]])})));return function(t){return e.apply(this,arguments)}}())));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.getPlugin=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u,c,p;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=X,e.next=4,this.graphql.request({query:n,params:{id:r},name:"plugin version"});case 4:if((a=e.sent.pluginRepo).releases[0].metadata){e.next=10;break}o=ht,e.next=23;break;case 10:return e.prev=10,s=t.resolveIpfsCid(a.releases[0].metadata),e.next=14,this.ipfs.fetchString(s);case 14:i=JSON.parse(e.sent),o=i,e.next=23;break;case 19:e.prev=19,e.t0=e.catch(10),o=mt,e.t0 instanceof t.InvalidCidError&&(o=gt);case 23:if(a.releases[0].builds[0].metadata){e.next=27;break}u=wt,e.next=40;break;case 27:return e.prev=27,c=t.resolveIpfsCid(a.releases[0].builds[0].metadata),e.next=31,this.ipfs.fetchString(c);case 31:p=JSON.parse(e.sent),u=p,e.next=40;break;case 36:e.prev=36,e.t1=e.catch(27),u=yt,e.t1 instanceof t.InvalidCidError&&(u=vt);case 40:return e.abrupt("return",tt(a,o,u));case 41:case"end":return e.stop()}}),e,this,[[10,19],[27,36]])})));return function(t){return e.apply(this,arguments)}}(),u}(Ae),bt=function(n){function s(){return n.apply(this,arguments)||this}k(s,n);var u=s.prototype;return u.applyInstallationAction=function(n,o){if(!i.isAddress(n))throw new t.InvalidAddressError;var s=this.web3.getNetworkName(),u=e.PluginSetupProcessor__factory.createInterface(),c=function(e){return{plugin:e.pluginAddress,pluginSetupRef:{pluginSetupRepo:e.pluginRepo,versionTag:e.versionTag},helpersHash:d.keccak256(r.defaultAbiCoder.encode(["address[]"],[e.helpers])),permissions:e.permissions.map((function(e){return A({},e,{condition:e.condition||a.AddressZero})}))}}(o),p=u.encodeFunctionData("applyInstallation",[n,c]),l=this.grantAction(n,{where:n,who:Re[s].pluginSetupProcessor,permission:je.ROOT_PERMISSION}),f=this.revokeAction(n,{where:n,who:Re[s].pluginSetupProcessor,permission:je.ROOT_PERMISSION});return[l,{to:Re[s].pluginSetupProcessor,value:BigInt(0),data:t.hexToBytes(p)},f]},u.applyUninstallationAction=function(r,n){var o=this.web3.getNetworkName(),s=e.PluginSetupProcessor__factory.createInterface(),i=function(e){return{plugin:e.pluginAddress,pluginSetupRef:{pluginSetupRepo:e.pluginRepo,versionTag:e.versionTag},permissions:e.permissions.map((function(e){return A({},e,{condition:e.condition||a.AddressZero})}))}}(n),u=s.encodeFunctionData("applyUninstallation",[r,i]),c=this.grantAction(r,{where:r,who:Re[o].pluginSetupProcessor,permission:je.ROOT_PERMISSION}),p=this.revokeAction(r,{where:r,who:Re[o].pluginSetupProcessor,permission:je.ROOT_PERMISSION});return[c,{to:Re[o].pluginSetupProcessor,value:BigInt(0),data:t.hexToBytes(u)},p]},u.grantAction=function(r,n){var a=n.where,o=n.who;if(!i.isAddress(a)||!i.isAddress(o)||!i.isAddress(r))throw new t.InvalidAddressError;var s=e.DAO__factory.createInterface(),u=nt({who:o,where:a,permission:n.permission}),c=s.encodeFunctionData("grant",u);return{to:r,value:BigInt(0),data:t.hexToBytes(c)}},u.grantWithConditionAction=function(r,n){var a=n.where,o=n.who;if(!i.isAddress(a)||!i.isAddress(o)||!i.isAddress(r))throw new t.InvalidAddressError;var s=e.DAO__factory.createInterface(),u=function(e){return[].concat(nt({who:e.who,where:e.where,permission:e.permission}),[e.condition])}({who:o,where:a,permission:n.permission,condition:n.condition}),c=s.encodeFunctionData("grantWithCondition",u);return{to:r,value:BigInt(0),data:t.hexToBytes(c)}},u.revokeAction=function(r,n){var a=n.where,o=n.who;if(!i.isAddress(a)||!i.isAddress(o)||!i.isAddress(r))throw new t.InvalidAddressError;var s=e.DAO__factory.createInterface(),u=nt({who:o,where:a,permission:n.permission}),c=s.encodeFunctionData("revoke",u);return{to:r,value:BigInt(0),data:t.hexToBytes(c)}},u.withdrawAction=function(){var e=I(y().mark((function e(r){var n,a,s,u,c;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.recipientAddressOrEns,i.isAddress(r.recipientAddressOrEns)){e.next=8;break}return e.next=4,null==(a=this.web3.getSigner())?void 0:a.resolveName(r.recipientAddressOrEns);case 4:if(s=e.sent){e.next=7;break}throw new Error("invalid ens");case 7:n=s;case 8:e.t0=r.type,e.next=e.t0===exports.TokenType.NATIVE?11:e.t0===exports.TokenType.ERC20?12:17;break;case 11:return e.abrupt("return",{to:n,value:r.amount,data:new Uint8Array});case 12:if(r.tokenAddress){e.next=14;break}throw new Error("Empty token contract address");case 14:return u=new o.Contract(r.tokenAddress,G).interface,c=u.encodeFunctionData("transfer",[r.recipientAddressOrEns,r.amount]),e.abrupt("return",{to:r.tokenAddress,value:BigInt(0),data:t.hexToBytes(c)});case 17:throw new Error("Unsupported token type");case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.updateDaoMetadataAction=function(){var r=I(y().mark((function r(n,a){var o,s,u,c,p,d;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n,i.isAddress(n)){r.next=8;break}return r.next=4,null==(s=this.web3.getSigner())?void 0:s.resolveName(n);case 4:if(u=r.sent){r.next=7;break}throw new Error("Invalid ENS");case 7:o=u;case 8:return c=e.DAO__factory.createInterface(),p=l.toUtf8Bytes(a),d=c.encodeFunctionData("setMetadata",[p]),r.abrupt("return",{to:o,value:BigInt(0),data:t.hexToBytes(d)});case 12:case"end":return r.stop()}}),r,this)})));return function(e,t){return r.apply(this,arguments)}}(),u.setDaoUriAction=function(r,n){var a=e.DAO__factory.createInterface().encodeFunctionData("setDaoURI",[n]);return{to:r,value:BigInt(0),data:t.hexToBytes(a)}},u.registerStandardCallbackAction=function(r,n){var a=e.DAO__factory.createInterface().encodeFunctionData("registerStandardCallback",[n.interfaceId,n.callbackSelector,n.magicNumber]);return{to:r,value:BigInt(0),data:t.hexToBytes(a)}},u.setSignatureValidatorAction=function(r,n){var a=e.DAO__factory.createInterface().encodeFunctionData("setSignatureValidator",[n]);return{to:r,value:BigInt(0),data:t.hexToBytes(a)}},u.upgradeToAction=function(r,n){var a=e.DAO__factory.createInterface().encodeFunctionData("upgradeTo",[n]);return{to:r,value:BigInt(0),data:t.hexToBytes(a)}},u.upgradeToAndCallAction=function(r,n){var a=e.DAO__factory.createInterface().encodeFunctionData("upgradeToAndCall",[n.implementationAddress,n.data]);return{to:r,value:BigInt(0),data:t.hexToBytes(a)}},s}(Ae),It=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var s=n.prototype;return s.createDao=function(){var t=I(y().mark((function t(r){var n,o,s,i,u,c,p,d;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.web3.getConnectedSigner(),!r.ensSubdomain||r.ensSubdomain.match(/^[a-z0-9\-]+$/)){t.next=3;break}throw new Error("Invalid subdomain format: use a-z, 0-9 and -");case 3:o=e.DAOFactory__factory.connect(this.web3.getDaoFactoryAddress(),n),s=[],i=P(r.plugins);case 6:if((u=i()).done){t.next=18;break}return p=e.PluginRepo__factory.connect((c=u.value).id,n),t.next=11,p.latestRelease();case 11:return d=t.sent,t.next=14,p["getLatestVersion(uint8)"](d);case 14:s.push({pluginSetupRef:{pluginSetupRepo:p.address,versionTag:t.sent.tag},data:c.data});case 16:t.next=6;break;case 18:return t.next=20,o.estimateGas.createDao({subdomain:r.ensSubdomain,metadata:l.toUtf8Bytes(r.metadataUri),daoURI:r.daoUri||"",trustedForwarder:r.trustedForwarder||a.AddressZero},s);case 20:return t.abrupt("return",this.web3.getApproximateGasFee(t.sent.toBigInt()));case 22:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.deposit=function(r){var n=this,o=this.web3.getConnectedSigner();if(r.type!==exports.TokenType.NATIVE&&r.type!==exports.TokenType.ERC20)throw new t.DepositNativeTokenError;var s=Xe(r),i=s[1],u=s[2],c=s[3],p=e.DAO__factory.connect(s[0],o),d={};return u===a.AddressZero&&(d.value=i),p.estimateGas.deposit(u,i,c,d).then((function(e){return n.web3.getApproximateGasFee(e.toBigInt())}))},s.setAllowance=function(){var e=I(y().mark((function e(r){var n,a,s,u,c,p=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.web3.getConnectedSigner(),i.isAddress(a=r.spender)){e.next=14;break}return e.next=5,this.web3.ensureOnline();case 5:if(s=this.web3.getProvider()){e.next=8;break}throw new t.NoProviderError;case 8:return e.next=10,s.resolveName(a);case 10:if(u=e.sent){e.next=13;break}throw new t.InvalidAddressOrEnsError;case 13:a=u;case 14:return c=new o.Contract(r.tokenAddress,G,n),e.abrupt("return",c.estimateGas.approve(a,r.amount).then((function(e){return p.web3.getApproximateGasFee(e.toBigInt())})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n}(Ae),At=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var s=n.prototype;return s.applyInstallationAction=function(r){var n=e.PluginSetupProcessor__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("applyInstallation");return rt(n.decodeFunctionData(o,a))},s.applyUninstallationAction=function(r){var n=e.PluginSetupProcessor__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("applyUninstallation");return rt(n.decodeFunctionData(o,a))},s.grantAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("grant");return at(n.decodeFunctionData(o,a))},s.grantWithConditionAction=function(r){var n,a=e.DAO__factory.createInterface(),o=t.bytesToHex(r),s=a.getFunction("grantWithCondition");return A({},at(n=a.decodeFunctionData(s,o)),{condition:n[3]})},s.revokeAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("revoke");return at(n.decodeFunctionData(o,a))},s.withdrawAction=function(e,r,n){if(null==n||!n.length)return{type:exports.TokenType.NATIVE,recipientAddressOrEns:e,amount:r};for(var s=0,i=[{tokenStandard:exports.TokenType.ERC20,abi:G}];s<i.length;s++){var u=i[s],c=t.bytesToHex(n),p=new o.Contract(a.AddressZero,u.abi).interface,d=p.getFunction("transfer");return ot(e,0,p.decodeFunctionData(d,c),u.tokenStandard)}throw new Error("The received action is not recognized")},s.updateDaoMetadataRawAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("setMetadata"),s=n.decodeFunctionData(o,a),i=l.toUtf8String(s[0]);return t.resolveIpfsCid(i),i},s.updateDaoMetadataAction=function(){var r=I(y().mark((function r(n){var a,o,s,i,u,c;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.DAO__factory.createInterface(),o=t.bytesToHex(n),s=a.getFunction("setMetadata"),i=a.decodeFunctionData(s,o),u=l.toUtf8String(i[0]),c=t.resolveIpfsCid(u),r.prev=6,r.next=9,this.ipfs.fetchString(c);case 9:return r.abrupt("return",JSON.parse(r.sent));case 13:throw r.prev=13,r.t0=r.catch(6),new Error("Error reading data from IPFS");case 16:case"end":return r.stop()}}),r,this,[[6,13]])})));return function(e){return r.apply(this,arguments)}}(),s.setDaoUriAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("setDaoURI");return n.decodeFunctionData(o,a)[0]},s.registerStandardCallbackAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("registerStandardCallback"),s=n.decodeFunctionData(o,a);return{interfaceId:s[0],callbackSelector:s[1],magicNumber:s[2]}},s.setSignatureValidatorAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("setSignatureValidator");return n.decodeFunctionData(o,a)[0]},s.upgradeToAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("upgradeTo");return n.decodeFunctionData(o,a)[0]},s.upgradeToAndCallAction=function(r){var n=e.DAO__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("upgradeToAndCall"),s=n.decodeFunctionData(o,a);return{implementationAddress:s[0],data:t.hexToBytes(s[1])}},s.findInterface=function(e){try{var r=We(e,pt);return{id:r.format("minimal"),functionName:r.name,hash:t.bytesToHex(e).substring(0,10)}}catch(e){return null}},n}(Ae),kt=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new xt(t),r.encoding=new bt(t),r.decoding=new At(t),r.estimation=new It(t),r}return k(t,e),t}(Ae),Et=s.gql(st||(st=E(["\nquery AddresslistVotingMembers($address: ID!) {\n    addresslistVotingPlugin(id: $address){\n        members {\n            address\n        }\n    }\n}\n"]))),St=s.gql(it||(it=E(["\nquery AddresslistVotingProposal($proposalId: ID!) {\n  addresslistVotingProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    creationBlockNumber\n    executionDate\n    executionBlockNumber\n    actions {\n      to\n      value\n      data\n    }\n    yes\n    no\n    abstain\n    votingMode\n    supportThreshold\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    potentiallyExecutable\n    executionTxHash\n    voters{\n      voter{\n        address\n      }\n      voteOption\n      voteReplaced\n    }\n    totalVotingPower\n    minVotingPower\n  }\n}\n"]))),Pt=s.gql(ut||(ut=E(["\nquery AddresslistVotingProposals($where: AddresslistVotingProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: AddresslistVotingProposal_orderBy!) {\n  addresslistVotingProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    yes\n    no\n    abstain\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    potentiallyExecutable\n    voters{\n      voter{\n        address\n      }\n      voteOption\n      voteReplaced\n    }\n  }\n}\n"]))),Tt=s.gql(ct||(ct=E(["\nquery AddresslistVotingSettings($address: ID!) {\n  addresslistVotingPlugin(id: $address){\n    minDuration\n    minProposerVotingPower\n    minParticipation\n    supportThreshold\n    votingMode\n  }\n}\n"])));function Dt(e,r){var n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate)),o=new Date(1e3*parseInt(e.createdAt)),s=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null;return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary,description:r.description,resources:r.resources,media:r.media},startDate:n,endDate:a,creationDate:o,executionTxHash:e.executionTxHash||null,creationBlockNumber:parseInt(e.creationBlockNumber),executionDate:s,executionBlockNumber:parseInt(e.executionBlockNumber)||null,actions:e.actions.map((function(e){return{data:t.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:Me(e),result:{yes:e.yes?parseInt(e.yes):0,no:e.no?parseInt(e.no):0,abstain:e.abstain?parseInt(e.abstain):0},settings:{supportThreshold:t.decodeRatio(BigInt(e.supportThreshold),6),minParticipation:t.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6),duration:parseInt(e.endDate)-parseInt(e.startDate)},totalVotingWeight:parseInt(e.totalVotingPower),votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:ie.get(e.voteOption)}}))}}function _t(e,r){var n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate));return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary},startDate:n,endDate:a,status:Me(e),result:{yes:e.yes?parseInt(e.yes):0,no:e.no?parseInt(e.no):0,abstain:e.abstain?parseInt(e.abstain):0},votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:ie.get(e.voteOption)}}))}}var Nt,Ct,Rt,Ot,Bt,Vt,Mt=function(n){function a(){return n.apply(this,arguments)||this}k(a,n),a.getPluginInstallItem=function(e,n){var a=c.getNetwork(n).name;if(!de.includes(a))throw new t.UnsupportedNetworkError(a);var o=He(e.votingSettings),s=r.defaultAbiCoder.encode(["tuple(uint8 votingMode, uint64 supportThreshold, uint64 minParticipation, uint64 minDuration, uint256 minProposerVotingPower) votingSettings","address[] members"],[[o.votingMode,o.supportThreshold,o.minParticipation,o.minDuration,o.minProposerVotingPower],e.addresses]);return{id:Re[a].addresslistVotingRepo,data:t.hexToBytes(s)}};var o=a.prototype;return o.updatePluginSettingsAction=function(e,r){if(!i.isAddress(e))throw new t.InvalidAddressError;return{to:e,value:BigInt(0),data:$e(r)}},o.addMembersAction=function(r,n){if(!i.isAddress(r))throw new t.InvalidAddressError;for(var a,o=P(n);!(a=o()).done;)if(!i.isAddress(a.value))throw new t.InvalidAddressError;var s=e.AddresslistVoting__factory.createInterface().encodeFunctionData("addAddresses",[n]);return{to:r,value:BigInt(0),data:t.hexToBytes(s)}},o.removeMembersAction=function(r,n){if(!i.isAddress(r))throw new t.InvalidAddressError;for(var a,o=P(n);!(a=o()).done;)if(!i.isAddress(a.value))throw new t.InvalidAddressError;var s=e.AddresslistVoting__factory.createInterface().encodeFunctionData("removeAddresses",[n]);return{to:r,value:BigInt(0),data:t.hexToBytes(s)}},a}(Ae),Ft=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,f,g,h,m,v,x,b,I;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=n.web3.getConnectedSigner(),p=e.AddresslistVoting__factory.connect(r.pluginAddress,c),null==(o=r.failSafeActions)||!o.length||r.failSafeActions.length===(null==(s=r.actions)?void 0:s.length)){a.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return d=t.boolArrayToBitmap(r.failSafeActions),f=(null==(i=r.startDate)?void 0:i.getTime())||0,g=(null==(u=r.endDate)?void 0:u.getTime())||0,a.next=9,w(p.createProposal(l.toUtf8Bytes(r.metadataUri),r.actions||[],d,Math.round(f/1e3),Math.round(g/1e3),r.creatorVote||0,r.executeOnPass||!1));case 9:return h=a.sent,a.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:h.hash};case 12:return a.next=14,w(h.wait());case 14:if(m=a.sent,v=e.AddresslistVoting__factory.createInterface(),x=Le(m,v,"ProposalCreated")){a.next=19;break}throw new t.ProposalCreationError;case 19:if(b=v.parseLog(x),I=b.args.proposalId){a.next=23;break}throw new t.ProposalCreationError;case 23:return a.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:t.encodeProposalId(r.pluginAddress,Number(I))};case 25:case"end":return a.stop()}}),a)})))()},a.pinMetadata=function(){var e=I(y().mark((function e(r){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(r));case 3:return n=e.sent,e.next=6,this.ipfs.pin(n);case 6:return e.abrupt("return","ipfs://"+n);case 9:throw e.prev=9,e.t0=e.catch(0),new t.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),a.voteProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r.proposalId),i=s.id,u=e.AddresslistVoting__factory.connect(s.pluginAddress,o),a.next=5,w(u.vote(i,r.vote,!1));case 5:return c=a.sent,a.next=8,{key:exports.VoteProposalStep.VOTING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.VoteProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.executeProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r),i=s.id,u=e.AddresslistVoting__factory.connect(s.pluginAddress,o),a.next=5,w(u.execute(i));case 5:return c=a.sent,a.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.prepareInstallation=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,l,f,g,h,m,v,x;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=n.web3.getConnectedSigner(),s=n.web3.getNetworkName(),i=e.PluginSetupProcessor__factory.connect(Re[s].pluginSetupProcessor,o),u=e.PluginRepo__factory.connect(Re[s].addresslistVotingRepo,o),c=r.versionTag,r.versionTag){a.next=10;break}return a.next=8,w(u["getLatestVersion(address)"](Re[s].addresslistVotingSetup));case 8:c={build:(p=a.sent).tag.build,release:p.tag.release};case 10:return d=Mt.getPluginInstallItem(r.settings,s),a.next=13,w(i.prepareInstallation(r.daoAddressOrEns,{pluginSetupRef:{pluginSetupRepo:Re[s].addresslistVotingRepo,versionTag:c},data:d.data}));case 13:return l=a.sent,a.next=16,{key:exports.PrepareInstallationStep.PREPARING,txHash:l.hash};case 16:return a.next=18,w(l.wait());case 18:if(f=a.sent,g=e.PluginSetupProcessor__factory.createInterface(),h=Le(f,g,"InstallationPrepared")){a.next=23;break}throw new t.ProposalCreationError;case 23:if(m=g.parseLog(h),x=m.args.preparedSetupData,(v=m.args.plugin)||x){a.next=28;break}throw new t.PluginInstallationPreparationError;case 28:return a.next=30,{key:exports.PrepareInstallationStep.DONE,pluginAddress:v,pluginRepo:Re[s].addresslistVotingRepo,versionTag:c,permissions:x.permissions,helpers:x.helpers};case 30:case"end":return a.stop()}}),a)})))()},a.canVote=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n.proposalId),s=o.id,i=e.AddresslistVoting__factory.connect(o.pluginAddress,a),r.abrupt("return",i.callStatic.canVote(s,n.voterAddressOrEns,n.vote));case 4:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.canExecute=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.AddresslistVoting__factory.connect(o.pluginAddress,a),r.abrupt("return",i.canExecute(s));case 4:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.getMembers=function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressError;case 2:return n=Et,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"AddresslistVotingVoting members"});case 7:return e.abrupt("return",e.sent.addresslistVotingPlugin.members.map((function(e){return e.address})));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getProposal=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isProposalId(r)){e.next=2;break}throw new t.InvalidProposalIdError;case 2:return n=t.getExtendedProposalId(r),a=St,o={proposalId:n},e.next=8,this.graphql.request({query:a,params:o,name:"AddresslistVoting proposal"});case 8:if(s=e.sent.addresslistVotingProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",Dt(s,Ee));case 16:return e.prev=16,i=t.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(i);case 20:return u=JSON.parse(e.sent),e.abrupt("return",Dt(s,u));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof t.InvalidCidError)){e.next=29;break}return e.abrupt("return",Dt(s,ke));case 29:return e.abrupt("return",Dt(s,Se));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),a.getProposals=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d,l,f,g,h,m,v,w,x=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(n=r.limit)?10:n,o=r.status,u=void 0===(s=r.skip)?0:s,p=void 0===(c=r.direction)?exports.SortDirection.ASC:c,l=void 0===(d=r.sortBy)?exports.ProposalSortBy.CREATED_AT:d,f={},!(g=r.daoAddressOrEns)){e.next=23;break}if(i.isAddress(g)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(h=this.web3.getProvider()){e.next=10;break}throw new t.NoProviderError;case 10:return e.prev=10,e.next=13,h.resolveName(g);case 13:if(m=e.sent){e.next=16;break}throw new t.InvalidAddressOrEnsError;case 16:g=m,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new t.InvalidAddressOrEnsError;case 22:f={dao:g.toLowerCase()};case 23:return o&&(f=A({},f,Fe(o))),v=Pt,w={where:f,limit:a,skip:u,direction:p,sortBy:l},e.next=29,this.graphql.request({query:v,params:w,name:"AddresslistVoting proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.addresslistVotingProposals.map(function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.metadata){e.next=2;break}return e.abrupt("return",_t(r,Ee));case 2:return e.prev=2,n=t.resolveIpfsCid(r.metadata),e.next=6,x.ipfs.fetchString(n);case 6:return a=JSON.parse(e.sent),e.abrupt("return",_t(r,a));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof t.InvalidCidError)){e.next=15;break}return e.abrupt("return",_t(r,ke));case 15:return e.abrupt("return",_t(r,Se));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),a.getVotingSettings=function(){var e=I(y().mark((function e(r){var n,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressError;case 2:return n=Tt,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"AddresslistVoting settings"});case 7:if(o=e.sent.addresslistVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",{minDuration:parseInt(o.minDuration),supportThreshold:t.decodeRatio(BigInt(o.supportThreshold),6),minParticipation:t.decodeRatio(BigInt(o.minParticipation),6),minProposerVotingPower:BigInt(o.minProposerVotingPower),votingMode:o.votingMode});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n}(Ae),Lt=[e.MajorityVotingBase__factory.createInterface().getFunction("updateVotingSettings").format("minimal"),e.AddresslistVoting__factory.createInterface().getFunction("addAddresses").format("minimal"),e.AddresslistVoting__factory.createInterface().getFunction("removeAddresses").format("minimal")],qt=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.updatePluginSettingsAction=function(e){return Ge(e)},a.addMembersAction=function(r){var n=e.AddresslistVoting__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("addAddresses");return n.decodeFunctionData(o,a)[0]},a.removeMembersAction=function(r){var n=e.AddresslistVoting__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("removeAddresses");return n.decodeFunctionData(o,a)[0]},a.findInterface=function(e){try{var r=We(e,Lt);return{id:r.format("minimal"),functionName:r.name,hash:t.bytesToHex(e).substring(0,10)}}catch(e){return null}},n}(Ae),Ut=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i,u,c,p,d,f;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=this.web3.getConnectedSigner(),c=e.AddresslistVoting__factory.connect(n.pluginAddress,u),null==(a=n.failSafeActions)||!a.length||n.failSafeActions.length===(null==(o=n.actions)?void 0:o.length)){r.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return p=t.boolArrayToBitmap(n.failSafeActions),d=(null==(s=n.startDate)?void 0:s.getTime())||0,f=(null==(i=n.endDate)?void 0:i.getTime())||0,r.next=9,c.estimateGas.createProposal(l.toUtf8Bytes(n.metadataUri),n.actions||[],p,Math.round(d/1e3),Math.round(f/1e3),n.creatorVote||0,n.executeOnPass||!1);case 9:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 11:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.voteProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n.proposalId),s=o.id,i=e.AddresslistVoting__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.vote(s,n.vote,!1);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.executeProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.AddresslistVoting__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.execute(s);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),n}(Ae),Gt=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new Ft(t),r.encoding=new Mt(t),r.decoding=new qt(t),r.estimation=new Ut(t),r}return k(t,e),t}(Ae);Gt.encoding={getPluginInstallItem:function(e,t){return void 0===t&&(t="mainnet"),Mt.getPluginInstallItem(e,t)}},(Nt=exports.WrapTokensStep||(exports.WrapTokensStep={})).WRAPPING="wrapping",Nt.DONE="done",(Ct=exports.UnwrapTokensStep||(exports.UnwrapTokensStep={})).UNWRAPPING="unwrapping",Ct.DONE="done",function(e){e.ERC20="ERC20Token",e.ERC721="ERC721Token"}(Rt||(Rt={})),function(e){e.ERC20="ERC20Contract",e.ERC721="ERC721Contract"}(Ot||(Ot={}));var $t,Ht,Wt,jt=s.gql(Bt||(Bt=E(["\nquery TokenVotingProposal($proposalId: ID!) {\n  tokenVotingProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    creationBlockNumber\n    executionDate\n    executionBlockNumber\n    actions {\n      to\n      value\n      data\n    }\n    yes,\n    no,\n    abstain\n    votingMode\n    supportThreshold\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    potentiallyExecutable\n    executionTxHash\n    voters{\n      voter{\n        address\n      }\n      voteReplaced\n      voteOption\n      votingPower\n    }\n    plugin {\n      token {\n        id\n        name\n        symbol\n        __typename\n        ...on ERC20Contract {\n          decimals\n        }\n      }\n    }\n    totalVotingPower\n    minVotingPower\n  }\n}\n"]))),Yt=s.gql(Vt||(Vt=E(["\nquery TokenVotingProposals($where: TokenVotingProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenVotingProposal_orderBy!) {\n  tokenVotingProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    yes,\n    no,\n    abstain\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    potentiallyExecutable\n    votingMode\n    supportThreshold\n    minVotingPower\n    totalVotingPower\n    voters{\n      voter{\n        address\n      }\n      voteReplaced\n      voteOption\n      votingPower\n    }\n    plugin{\n      token{\n        id\n        name\n        symbol\n        __typename\n        ...on ERC20Contract {\n          decimals\n        }\n      }\n    }\n  }\n}\n"]))),Xt=s.gql($t||($t=E(["\nquery TokenVotingSettings($address: ID!) {\n  tokenVotingPlugin(id: $address){\n    minDuration\n    minProposerVotingPower\n    minParticipation\n    supportThreshold\n    votingMode\n  }\n}\n"]))),zt=s.gql(Ht||(Ht=E(["\nquery TokenVotingPlugin($address: ID!) {\n  tokenVotingPlugin(id: $address){\n    token {\n      id\n      name\n      symbol\n      __typename\n      ...on ERC20Contract {\n        decimals\n      }\n    }\n  }\n}\n"]))),Jt=s.gql(Wt||(Wt=E(["\nquery TokenVotingMembers($address: ID!) {\n    tokenVotingPlugin(id: $address){\n        members {\n            address\n            balance\n            votingPower\n            delegatee {\n                address\n            }\n            delegators {\n                address\n                balance\n            }\n        }\n    }\n}\n"])));function Kt(e,r){for(var n,a=new Date(1e3*parseInt(e.startDate)),o=new Date(1e3*parseInt(e.endDate)),s=new Date(1e3*parseInt(e.createdAt)),i=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null,u=BigInt(0),c=P(e.voters);!(n=c()).done;)u+=BigInt(n.value.votingPower);var p=Qt(e.plugin.token);return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary,description:r.description,resources:r.resources,media:r.media},startDate:a,endDate:o,creationDate:s,creationBlockNumber:parseInt(e.creationBlockNumber),executionDate:i,executionBlockNumber:parseInt(e.executionBlockNumber)||null,executionTxHash:e.executionTxHash||null,actions:e.actions.map((function(e){return{data:t.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:Me(e),result:{yes:e.yes?BigInt(e.yes):BigInt(0),no:e.no?BigInt(e.no):BigInt(0),abstain:e.abstain?BigInt(e.abstain):BigInt(0)},settings:{supportThreshold:t.decodeRatio(BigInt(e.supportThreshold),6),duration:parseInt(e.endDate)-parseInt(e.startDate),minParticipation:t.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6)},token:p,usedVotingWeight:u,totalVotingWeight:BigInt(e.totalVotingPower),votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:ie.get(e.voteOption),weight:BigInt(e.votingPower)}}))}}function Zt(e,r){var n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate)),o=Qt(e.plugin.token);return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},settings:{supportThreshold:t.decodeRatio(BigInt(e.supportThreshold),6),duration:parseInt(e.endDate)-parseInt(e.startDate),minParticipation:t.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6)},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary},totalVotingWeight:BigInt(e.totalVotingPower),startDate:n,endDate:a,status:Me(e),result:{yes:e.yes?BigInt(e.yes):BigInt(0),no:e.no?BigInt(e.no):BigInt(0),abstain:e.abstain?BigInt(e.abstain):BigInt(0)},token:o,votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:ie.get(e.voteOption),weight:BigInt(e.votingPower)}}))}}function Qt(e){var t=null;return e.__typename===Ot.ERC20?t={address:e.id,symbol:e.symbol,name:e.name,decimals:e.decimals,type:exports.TokenType.ERC20}:e.__typename===Ot.ERC721&&(t={address:e.id,symbol:e.symbol,name:e.name,type:exports.TokenType.ERC721}),t}function er(e){return{address:e.address,votingPower:BigInt(e.votingPower),balance:BigInt(e.balance),delegatee:e.delegatee.address===e.address?null:e.delegatee.address,delegators:e.delegators.filter((function(t){return t.address!==e.address})).map((function(e){return{address:e.address,balance:BigInt(e.balance)}}))}}var tr,rr,nr,ar=function(o){function s(){return o.apply(this,arguments)||this}k(s,o),s.getPluginInstallItem=function(e,o){var s=c.getNetwork(o).name;if(!de.includes(s))throw new t.UnsupportedNetworkError(s);var i=function(e){var t=["","",""],r=[[],[]];if(e.newToken)t=[a.AddressZero,e.newToken.name,e.newToken.symbol],r=[e.newToken.balances.map((function(e){return e.address})),e.newToken.balances.map((function(e){return n.BigNumber.from(e.balance)}))];else if(e.useToken){var o;t=[null==(o=e.useToken)?void 0:o.tokenAddress,e.useToken.wrappedToken.name,e.useToken.wrappedToken.symbol]}return[Object.values(He(e.votingSettings)),t,r]}(e),u=r.defaultAbiCoder.encode(["tuple(uint8 votingMode, uint64 supportThreshold, uint64 minParticipation, uint64 minDuration, uint256 minProposerVotingPower) votingSettings","tuple(address addr, string name, string symbol) tokenSettings","tuple(address[] receivers, uint256[] amounts) mintSettings"],i);return{id:Re[s].tokenVotingRepo,data:t.hexToBytes(u)}};var u=s.prototype;return u.updatePluginSettingsAction=function(e,t){if(!i.isAddress(e))throw new Error("Invalid plugin address");return{to:e,value:BigInt(0),data:$e(t)}},u.mintTokenAction=function(r,a){if(!i.isAddress(r)||!i.isAddress(a.address))throw new t.InvalidAddressError;var o=e.IERC20MintableUpgradeable__factory.createInterface(),s=function(e){return[e.address,n.BigNumber.from(e.amount)]}(a),u=o.encodeFunctionData("mint",s);return{to:r,value:BigInt(0),data:t.hexToBytes(u)}},s}(Ae),or=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,f,g,h,m,v,x,b,I;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=n.web3.getConnectedSigner(),p=e.TokenVoting__factory.connect(r.pluginAddress,c),null==(o=r.failSafeActions)||!o.length||r.failSafeActions.length===(null==(s=r.actions)?void 0:s.length)){a.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return d=t.boolArrayToBitmap(r.failSafeActions),f=(null==(i=r.startDate)?void 0:i.getTime())||0,g=(null==(u=r.endDate)?void 0:u.getTime())||0,a.next=9,w(p.createProposal(l.toUtf8Bytes(r.metadataUri),r.actions||[],d,Math.round(f/1e3),Math.round(g/1e3),r.creatorVote||0,r.executeOnPass||!1));case 9:return h=a.sent,a.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:h.hash};case 12:return a.next=14,w(h.wait());case 14:if(m=a.sent,v=e.TokenVoting__factory.createInterface(),x=Le(m,v,"ProposalCreated")){a.next=19;break}throw new t.ProposalCreationError;case 19:if(b=v.parseLog(x),I=b.args.proposalId){a.next=23;break}throw new t.ProposalCreationError;case 23:return a.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:t.encodeProposalId(r.pluginAddress,Number(I))};case 25:case"end":return a.stop()}}),a)})))()},a.pinMetadata=function(){var e=I(y().mark((function e(r){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(r));case 3:return n=e.sent,e.next=6,this.ipfs.pin(n);case 6:return e.abrupt("return","ipfs://"+n);case 9:throw e.prev=9,e.t0=e.catch(0),new t.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),a.voteProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r.proposalId),i=s.id,u=e.TokenVoting__factory.connect(s.pluginAddress,o),a.next=5,w(u.vote(i,r.vote,!1));case 5:return c=a.sent,a.next=8,{key:exports.VoteProposalStep.VOTING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.VoteProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.executeProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r),i=s.id,u=e.TokenVoting__factory.connect(s.pluginAddress,o),a.next=5,w(u.execute(i));case 5:return c=a.sent,a.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.prepareInstallation=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,l,f,g,h,m,v,x;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=n.web3.getConnectedSigner(),s=n.web3.getNetworkName(),i=e.PluginSetupProcessor__factory.connect(Re[s].pluginSetupProcessor,o),u=e.PluginRepo__factory.connect(Re[s].tokenVotingRepo,o),c=r.versionTag,r.versionTag){a.next=10;break}return a.next=8,w(u["getLatestVersion(address)"](Re[s].tokenVotingSetup));case 8:c={build:(p=a.sent).tag.build,release:p.tag.release};case 10:return d=ar.getPluginInstallItem(r.settings,s),a.next=13,w(i.prepareInstallation(r.daoAddressOrEns,{pluginSetupRef:{pluginSetupRepo:Re[s].tokenVotingRepo,versionTag:c},data:d.data}));case 13:return l=a.sent,a.next=16,{key:exports.PrepareInstallationStep.PREPARING,txHash:l.hash};case 16:return a.next=18,w(l.wait());case 18:if(f=a.sent,g=e.PluginSetupProcessor__factory.createInterface(),h=Le(f,g,"InstallationPrepared")){a.next=23;break}throw new t.PluginInstallationPreparationError;case 23:if(m=g.parseLog(h),x=m.args.preparedSetupData,(v=m.args.plugin)||x){a.next=28;break}throw new t.PluginInstallationPreparationError;case 28:return a.next=30,{key:exports.PrepareInstallationStep.DONE,pluginAddress:v,pluginRepo:Re[s].tokenVotingRepo,versionTag:c,permissions:x.permissions,helpers:x.helpers};case 30:case"end":return a.stop()}}),a)})))()},a.wrapTokens=function(r){var n=this;return x(y().mark((function a(){var o,s,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=n.web3.getConnectedSigner(),i.isAddress(r.wrappedTokenAddress)){a.next=3;break}throw new t.InvalidAddressError;case 3:return s=e.GovernanceWrappedERC20__factory.connect(r.wrappedTokenAddress,o),a.next=6,w(o.getAddress());case 6:return u=a.sent,a.next=9,w(s.depositFor(u,r.amount));case 9:return c=a.sent,a.next=12,{key:exports.WrapTokensStep.WRAPPING,txHash:c.hash};case 12:return a.next=14,w(c.wait());case 14:return a.next=16,{key:exports.WrapTokensStep.DONE};case 16:case"end":return a.stop()}}),a)})))()},a.unwrapTokens=function(r){var n=this;return x(y().mark((function a(){var o,s,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=n.web3.getConnectedSigner(),i.isAddress(r.wrappedTokenAddress)){a.next=3;break}throw new t.InvalidAddressError;case 3:return s=e.GovernanceWrappedERC20__factory.connect(r.wrappedTokenAddress,o),a.next=6,w(o.getAddress());case 6:return u=a.sent,a.next=9,w(s.withdrawTo(u,r.amount));case 9:return c=a.sent,a.next=12,{key:exports.UnwrapTokensStep.UNWRAPPING,txHash:c.hash};case 12:return a.next=14,w(c.wait());case 14:return a.next=16,{key:exports.UnwrapTokensStep.DONE};case 16:case"end":return a.stop()}}),a)})))()},a.delegateTokens=function(t){var r=this;return x(y().mark((function n(){var a,o,s;return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.web3.getConnectedSigner(),o=e.GovernanceERC20__factory.connect(t.tokenAddress,a),n.next=4,w(o.delegate(t.delegatee));case 4:return s=n.sent,n.next=7,{key:"delegating",txHash:s.hash};case 7:return n.next=9,w(s.wait());case 9:return n.next=11,{key:"done"};case 11:case"end":return n.stop()}}),n)})))()},a.undelegateTokens=function(e){var t=this;return x(y().mark((function r(){var n;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.web3.getConnectedSigner(),r.t0=h,r.t1=m,r.t2=t,r.t3=e,r.next=7,w(n.getAddress());case 7:return r.t4=r.sent,r.t5={tokenAddress:r.t3,delegatee:r.t4},r.t6=r.t2.delegateTokens.call(r.t2,r.t5),r.t7=(0,r.t1)(r.t6),r.t8=w,r.delegateYield((0,r.t0)(r.t7,r.t8),"t9",13);case 13:case"end":return r.stop()}}),r)})))()},a.getDelegatee=function(){var t=I(y().mark((function t(r){var n,a,o,s;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.web3.getConnectedSigner(),a=e.GovernanceERC20__factory.connect(r,n),t.next=4,n.getAddress();case 4:return o=t.sent,t.next=7,a.delegates(o);case 7:return t.abrupt("return",o===(s=t.sent)?null:s);case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.canVote=function(){var r=I(y().mark((function r(n){var a,o,s,u;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=this.web3.getConnectedSigner(),i.isAddress(n.voterAddressOrEns)){r.next=3;break}throw new t.InvalidAddressError;case 3:return o=t.decodeProposalId(n.proposalId),s=o.id,u=e.TokenVoting__factory.connect(o.pluginAddress,a),r.abrupt("return",u.callStatic.canVote(s,n.voterAddressOrEns,n.vote));case 6:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.canExecute=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.TokenVoting__factory.connect(o.pluginAddress,a),r.abrupt("return",i.canExecute(s));case 4:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.getMembers=function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressError;case 2:return n=Jt,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"TokenVoting members"});case 7:return e.abrupt("return",e.sent.tokenVotingPlugin.members.map((function(e){return er(e)})));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getProposal=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isProposalId(r)){e.next=2;break}throw new t.InvalidProposalIdError;case 2:return n=t.getExtendedProposalId(r),a=jt,o={proposalId:n},e.next=8,this.graphql.request({query:a,params:o,name:"TokenVoting proposal"});case 8:if(s=e.sent.tokenVotingProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",Kt(s,Ee));case 16:return e.prev=16,i=t.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(i);case 20:return u=JSON.parse(e.sent),e.abrupt("return",Kt(s,u));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof t.InvalidCidError)){e.next=29;break}return e.abrupt("return",Kt(s,ke));case 29:return e.abrupt("return",Kt(s,Se));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),a.getProposals=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d,l,f,g,h,m,v,w,x=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(n=r.limit)?10:n,o=r.status,u=void 0===(s=r.skip)?0:s,p=void 0===(c=r.direction)?exports.SortDirection.ASC:c,l=void 0===(d=r.sortBy)?exports.ProposalSortBy.CREATED_AT:d,f={},!(g=r.daoAddressOrEns)){e.next=23;break}if(i.isAddress(g)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(h=this.web3.getProvider()){e.next=10;break}throw new t.NoProviderError;case 10:return e.prev=10,e.next=13,h.resolveName(g);case 13:if(m=e.sent){e.next=16;break}throw new t.InvalidAddressOrEnsError;case 16:g=m,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new t.InvalidAddressOrEnsError(e.t0);case 22:f={dao:g.toLowerCase()};case 23:return o&&(f=A({},f,Fe(o))),v=Yt,w={where:f,limit:a,skip:u,direction:p,sortBy:l},e.next=29,this.graphql.request({query:v,params:w,name:"TokenVoting proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.tokenVotingProposals.map(function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.metadata){e.next=2;break}return e.abrupt("return",Zt(r,Ee));case 2:return e.prev=2,n=t.resolveIpfsCid(r.metadata),e.next=6,x.ipfs.fetchString(n);case 6:return a=JSON.parse(e.sent),e.abrupt("return",Zt(r,a));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof t.InvalidCidError)){e.next=15;break}return e.abrupt("return",Zt(r,ke));case 15:return e.abrupt("return",Zt(r,Se));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),a.getVotingSettings=function(){var e=I(y().mark((function e(r){var n,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressError;case 2:return n=Xt,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"TokenVoting settings"});case 7:if(o=e.sent.tokenVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",{minDuration:parseInt(o.minDuration),supportThreshold:t.decodeRatio(BigInt(o.supportThreshold),6),minParticipation:t.decodeRatio(BigInt(o.minParticipation),6),minProposerVotingPower:BigInt(o.minProposerVotingPower),votingMode:o.votingMode});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getToken=function(){var e=I(y().mark((function e(r){var n,a,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressError;case 2:return n=zt,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"TokenVoting token"});case 7:if(o=e.sent.tokenVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:if((s=o.token).__typename!==Ot.ERC20){e.next=16;break}return e.abrupt("return",{address:s.id,name:s.name,symbol:s.symbol,decimals:s.decimals,type:exports.TokenType.ERC20});case 16:if(s.__typename!==Ot.ERC721){e.next=18;break}return e.abrupt("return",{address:s.id,name:s.name,symbol:s.symbol,type:exports.TokenType.ERC721});case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n}(Ae),sr=[e.MajorityVotingBase__factory.createInterface().getFunction("updateVotingSettings").format("minimal"),e.IERC20MintableUpgradeable__factory.createInterface().getFunction("mint").format("minimal")],ir=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.updatePluginSettingsAction=function(e){return Ge(e)},a.mintTokenAction=function(r){var n,a=e.IERC20MintableUpgradeable__factory.createInterface(),o=t.bytesToHex(r),s=a.getFunction("mint");return{address:(n=a.decodeFunctionData(s,o))[0],amount:BigInt(n[1])}},a.findInterface=function(e){try{var r=We(e,sr);return{id:r.format("minimal"),functionName:r.name,hash:t.bytesToHex(e).substring(0,10)}}catch(e){return null}},n}(Ae),ur=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i,u,c,p,d,f;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=this.web3.getConnectedSigner(),c=e.TokenVoting__factory.connect(n.pluginAddress,u),null==(a=n.failSafeActions)||!a.length||n.failSafeActions.length===(null==(o=n.actions)?void 0:o.length)){r.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return p=t.boolArrayToBitmap(n.failSafeActions),d=(null==(s=n.startDate)?void 0:s.getTime())||0,f=(null==(i=n.endDate)?void 0:i.getTime())||0,r.next=9,c.estimateGas.createProposal(l.toUtf8Bytes(n.metadataUri),n.actions||[],p,Math.round(d/1e3),Math.round(f/1e3),n.creatorVote||0,n.executeOnPass||!1);case 9:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 11:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.voteProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n.proposalId),s=o.id,i=e.TokenVoting__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.vote(s,n.vote,!1);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.executeProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.TokenVoting__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.execute(s);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.delegateTokens=function(){var t=I(y().mark((function t(r){var n,a;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.web3.getConnectedSigner(),a=e.GovernanceERC20__factory.connect(r.tokenAddress,n),t.next=4,a.estimateGas.delegate(r.delegatee);case 4:return t.abrupt("return",this.web3.getApproximateGasFee(t.sent.toBigInt()));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.undelegateTokens=function(){var e=I(y().mark((function e(t){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.web3.getConnectedSigner(),e.t0=this,e.t1=t,e.next=5,r.getAddress();case 5:return e.t2=e.sent,e.t3={tokenAddress:e.t1,delegatee:e.t2},e.abrupt("return",e.t0.delegateTokens.call(e.t0,e.t3));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n}(Ae),cr=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new or(t),r.encoding=new ar(t),r.decoding=new ir(t),r.estimation=new ur(t),r}return k(t,e),t}(Ae);cr.encoding={getPluginInstallItem:function(e,t){return void 0===t&&(t="mainnet"),ar.getPluginInstallItem(e,t)}},(tr=exports.ApproveProposalStep||(exports.ApproveProposalStep={})).APPROVING="approving",tr.DONE="done";var pr,dr,lr=s.gql(rr||(rr=E(["\nquery MultisigProposal($proposalId: ID!) {\n  multisigProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    startDate\n    endDate\n    actions {\n      to\n      value\n      data\n    }\n    executionDate\n    executionBlockNumber\n    creationBlockNumber\n    plugin {\n      onlyListed\n    }\n    minApprovals\n    executionTxHash\n    executed\n    potentiallyExecutable\n    approvers{\n      id\n    }\n  }\n}\n"]))),fr=s.gql(nr||(nr=E(["\nquery MultisigProposals($where: MultisigProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: MultisigProposal_orderBy!) {\n  multisigProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    executed\n    potentiallyExecutable\n    approvals\n    startDate\n    endDate\n    executionDate\n    executionBlockNumber\n    creationBlockNumber\n    approvers {\n      id\n    }\n    minApprovals\n    plugin{\n      onlyListed\n    }\n  }\n}\n"]))),gr=s.gql(pr||(pr=E(["\nquery MultisigVotingSettings($address: ID!) {\n    multisigPlugin(id: $address){\n        minApprovals\n        onlyListed\n    }\n}\n"]))),hr=s.gql(dr||(dr=E(["\nquery MultisigMembers($address: ID!) {\n    multisigPlugin(id: $address){\n        members {\n            address\n        }\n    }\n}\n"])));function mr(e,r){var n=new Date(1e3*parseInt(e.createdAt)),a=new Date(1e3*parseInt(e.startDate)),o=new Date(1e3*parseInt(e.endDate)),s=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null;return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary,description:r.description,resources:r.resources,media:r.media},settings:{onlyListed:e.plugin.onlyListed,minApprovals:e.minApprovals},creationBlockNumber:parseInt(e.creationBlockNumber)||0,creationDate:n,startDate:a,endDate:o,executionDate:s,executionBlockNumber:parseInt(e.executionBlockNumber)||null,executionTxHash:e.executionTxHash||null,actions:e.actions.map((function(e){return{data:t.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:Me(e),approvals:e.approvers.map((function(e){return e.id.slice(0,42)}))}}function vr(e,r){var n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate));return{id:t.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:r.title,summary:r.summary},approvals:e.approvers.map((function(e){return e.id.slice(0,42)})),settings:{onlyListed:e.plugin.onlyListed,minApprovals:e.minApprovals},startDate:n,endDate:a,status:Me(e)}}var wr=function(n){function a(){return n.apply(this,arguments)||this}k(a,n),a.getPluginInstallItem=function(e,n){var a=c.getNetwork(n).name;if(!de.includes(a))throw new t.UnsupportedNetworkError(a);var o=r.defaultAbiCoder.encode(["address[]","tuple(bool, uint16)"],[e.members,[e.votingSettings.onlyListed,e.votingSettings.minApprovals]]);return{id:Re[a].multisigRepo,data:t.hexToBytes(o)}};var o=a.prototype;return o.addAddressesAction=function(r){if(!i.isAddress(r.pluginAddress))throw new t.InvalidAddressError;for(var n,a=P(r.members);!(n=a()).done;)if(!i.isAddress(n.value))throw new t.InvalidAddressError;var o=e.Multisig__factory.createInterface().encodeFunctionData("addAddresses",[r.members]);return{to:r.pluginAddress,value:BigInt(0),data:t.hexToBytes(o)}},o.removeAddressesAction=function(r){if(!i.isAddress(r.pluginAddress))throw new t.InvalidAddressError;for(var n,a=P(r.members);!(n=a()).done;)if(!i.isAddress(n.value))throw new t.InvalidAddressError;var o=e.Multisig__factory.createInterface().encodeFunctionData("removeAddresses",[r.members]);return{to:r.pluginAddress,value:BigInt(0),data:t.hexToBytes(o)}},o.updateMultisigVotingSettings=function(r){if(!i.isAddress(r.pluginAddress))throw new t.InvalidAddressError;var n=e.Multisig__factory.createInterface().encodeFunctionData("updateMultisigSettings",[r.votingSettings]);return{to:r.pluginAddress,value:BigInt(0),data:t.hexToBytes(n)}},a}(Ae),yr=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,f,g,h,m,v,x,b,I;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=n.web3.getConnectedSigner(),p=e.Multisig__factory.connect(r.pluginAddress,c),null==(o=r.failSafeActions)||!o.length||r.failSafeActions.length===(null==(s=r.actions)?void 0:s.length)){a.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return d=t.boolArrayToBitmap(r.failSafeActions),f=(null==(i=r.startDate)?void 0:i.getTime())||0,g=(null==(u=r.endDate)?void 0:u.getTime())||0,a.next=9,w(p.createProposal(l.toUtf8Bytes(r.metadataUri),r.actions||[],d,r.approve||!1,r.tryExecution||!1,Math.round(f/1e3),Math.round(g/1e3)));case 9:return h=a.sent,a.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:h.hash};case 12:return a.next=14,w(h.wait());case 14:if(m=a.sent,v=e.Multisig__factory.createInterface(),x=Le(m,v,"ProposalCreated")){a.next=19;break}throw new t.ProposalCreationError;case 19:if(b=v.parseLog(x),I=b.args.proposalId){a.next=23;break}throw new t.ProposalCreationError;case 23:return a.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:t.encodeProposalId(r.pluginAddress,Number(I))};case 25:case"end":return a.stop()}}),a)})))()},a.pinMetadata=function(){var e=I(y().mark((function e(r){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(r));case 3:return n=e.sent,e.next=6,this.ipfs.pin(n);case 6:return e.abrupt("return","ipfs://"+n);case 9:throw e.prev=9,e.t0=e.catch(0),new t.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),a.approveProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r.proposalId),i=s.id,u=e.Multisig__factory.connect(s.pluginAddress,o),a.next=5,w(u.approve(i,r.tryExecution));case 5:return c=a.sent,a.next=8,{key:exports.ApproveProposalStep.APPROVING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.ApproveProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.executeProposal=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=n.web3.getConnectedSigner(),s=t.decodeProposalId(r),i=s.id,u=e.Multisig__factory.connect(s.pluginAddress,o),a.next=5,w(u.execute(i));case 5:return c=a.sent,a.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:c.hash};case 8:return a.next=10,w(c.wait());case 10:return a.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return a.stop()}}),a)})))()},a.prepareInstallation=function(r){var n=this;return x(y().mark((function a(){var o,s,i,u,c,p,d,l,f,g,h,m,v,x;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=n.web3.getConnectedSigner(),s=n.web3.getNetworkName(),i=e.PluginSetupProcessor__factory.connect(Re[s].pluginSetupProcessor,o),u=e.PluginRepo__factory.connect(Re[s].multisigRepo,o),c=r.versionTag,r.versionTag){a.next=10;break}return a.next=8,w(u["getLatestVersion(address)"](Re[s].multisigSetup));case 8:c={build:(p=a.sent).tag.build,release:p.tag.release};case 10:return d=wr.getPluginInstallItem(r.settings,s),a.next=13,w(i.prepareInstallation(r.daoAddressOrEns,{pluginSetupRef:{pluginSetupRepo:Re[s].multisigRepo,versionTag:c},data:d.data}));case 13:return l=a.sent,a.next=16,{key:exports.PrepareInstallationStep.PREPARING,txHash:l.hash};case 16:return a.next=18,w(l.wait());case 18:if(f=a.sent,g=e.PluginSetupProcessor__factory.createInterface(),h=Le(f,g,"InstallationPrepared")){a.next=23;break}throw new t.ProposalCreationError;case 23:if(m=g.parseLog(h),x=m.args.preparedSetupData,(v=m.args.plugin)||x){a.next=28;break}throw new t.PluginInstallationPreparationError;case 28:return a.next=30,{key:exports.PrepareInstallationStep.DONE,pluginAddress:v,pluginRepo:Re[s].multisigRepo,versionTag:c,permissions:x.permissions,helpers:x.helpers};case 30:case"end":return a.stop()}}),a)})))()},a.canApprove=function(){var r=I(y().mark((function r(n){var a,o,s,u;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=this.web3.getConnectedSigner(),i.isAddress(n.approverAddressOrEns)){r.next=3;break}throw new t.InvalidAddressOrEnsError;case 3:return o=t.decodeProposalId(n.proposalId),s=o.id,u=e.Multisig__factory.connect(o.pluginAddress,a),r.abrupt("return",u.canApprove(s,n.approverAddressOrEns));case 6:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.canExecute=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.Multisig__factory.connect(o.pluginAddress,a),r.abrupt("return",i.canExecute(s));case 4:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.getVotingSettings=function(){var e=I(y().mark((function e(r){var n,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressOrEnsError;case 2:return n=gr,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"Multisig settings"});case 7:return e.abrupt("return",{onlyListed:(o=e.sent.multisigPlugin).onlyListed,minApprovals:o.minApprovals});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getMembers=function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isAddress(r)){e.next=2;break}throw new t.InvalidAddressOrEnsError;case 2:return n=hr,a={address:r.toLowerCase()},e.next=7,this.graphql.request({query:n,params:a,name:"Multisig members"});case 7:return e.abrupt("return",e.sent.multisigPlugin.members.map((function(e){return e.address})));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getProposal=function(){var e=I(y().mark((function e(r){var n,a,o,s,i,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isProposalId(r)){e.next=2;break}throw new t.InvalidProposalIdError;case 2:return n=t.getExtendedProposalId(r),a=lr,o={proposalId:n},e.next=8,this.graphql.request({query:a,params:o,name:"Multisig proposal"});case 8:if(s=e.sent.multisigProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",mr(s,Ee));case 16:return e.prev=16,i=t.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(i);case 20:return u=JSON.parse(e.sent),e.abrupt("return",mr(s,u));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof t.InvalidCidError)){e.next=29;break}return e.abrupt("return",mr(s,ke));case 29:return e.abrupt("return",mr(s,Se));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),a.getProposals=function(){var e=I(y().mark((function e(r){var n,a,o,s,u,c,p,d,l,f,g,h,m,v,w,x=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(n=r.limit)?10:n,o=r.status,u=void 0===(s=r.skip)?0:s,p=void 0===(c=r.direction)?exports.SortDirection.ASC:c,l=void 0===(d=r.sortBy)?exports.ProposalSortBy.CREATED_AT:d,f={},!(g=r.daoAddressOrEns)){e.next=23;break}if(i.isAddress(g)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(h=this.web3.getProvider()){e.next=10;break}throw new t.NoProviderError;case 10:return e.prev=10,e.next=13,h.resolveName(g);case 13:if(m=e.sent){e.next=16;break}throw new t.InvalidAddressOrEnsError;case 16:g=m,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new t.InvalidAddressOrEnsError(e.t0);case 22:f={dao:g.toLowerCase()};case 23:return o&&(f=A({},f,Fe(o))),v=fr,w={where:f,limit:a,skip:u,direction:p,sortBy:l},e.next=29,this.graphql.request({query:v,params:w,name:"Multisig proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.multisigProposals.map(function(){var e=I(y().mark((function e(r){var n,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.metadata){e.next=2;break}return e.abrupt("return",vr(r,Ee));case 2:return e.prev=2,n=t.resolveIpfsCid(r.metadata),e.next=6,x.ipfs.fetchString(n);case 6:return a=JSON.parse(e.sent),e.abrupt("return",vr(r,a));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof t.InvalidCidError)){e.next=15;break}return e.abrupt("return",vr(r,ke));case 15:return e.abrupt("return",vr(r,Se));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),n}(Ae),xr=[e.Multisig__factory.createInterface().getFunction("addAddresses").format("minimal"),e.Multisig__factory.createInterface().getFunction("removeAddresses").format("minimal"),e.Multisig__factory.createInterface().getFunction("updateMultisigSettings").format("minimal")],br=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.addAddressesAction=function(r){var n=e.Multisig__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("addAddresses");return n.decodeFunctionData(o,a)[0]},a.removeAddressesAction=function(r){var n=e.Multisig__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("removeAddresses");return n.decodeFunctionData(o,a)[0]},a.updateMultisigVotingSettings=function(r){var n=e.Multisig__factory.createInterface(),a=t.bytesToHex(r),o=n.getFunction("updateMultisigSettings"),s=n.decodeFunctionData(o,a);return{minApprovals:s[0].minApprovals,onlyListed:s[0].onlyListed}},a.findInterface=function(e){try{var r=We(e,xr);return{id:r.format("minimal"),functionName:r.name,hash:t.bytesToHex(e).substring(0,10)}}catch(e){return null}},n}(Ae),Ir=function(r){function n(){return r.apply(this,arguments)||this}k(n,r);var a=n.prototype;return a.createProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i,u,c,p,d,f;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=this.web3.getConnectedSigner(),c=e.Multisig__factory.connect(n.pluginAddress,u),null==(a=n.failSafeActions)||!a.length||n.failSafeActions.length===(null==(o=n.actions)?void 0:o.length)){r.next=4;break}throw new Error("Size mismatch: actions and failSafeActions should match");case 4:return p=t.boolArrayToBitmap(n.failSafeActions),d=(null==(s=n.startDate)?void 0:s.getTime())||0,f=(null==(i=n.endDate)?void 0:i.getTime())||0,r.next=9,c.estimateGas.createProposal(l.toUtf8Bytes(n.metadataUri),n.actions||[],p,n.approve||!1,n.tryExecution||!0,Math.round(d/1e3),Math.round(f/1e3));case 9:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 11:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.approveProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n.proposalId),s=o.id,i=e.Multisig__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.approve(s,n.tryExecution);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),a.executeProposal=function(){var r=I(y().mark((function r(n){var a,o,s,i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.web3.getConnectedSigner(),o=t.decodeProposalId(n),s=o.id,i=e.Multisig__factory.connect(o.pluginAddress,a),r.next=5,i.estimateGas.execute(s);case 5:return r.abrupt("return",this.web3.getApproximateGasFee(r.sent.toBigInt()));case 7:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),n}(Ae),Ar=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new yr(t),r.encoding=new wr(t),r.decoding=new br(t),r.estimation=new Ir(t),r}return k(t,e),t}(Ae);Ar.encoding={getPluginInstallItem:function(e,t){return void 0===t&&(t="mainnet"),wr.getPluginInstallItem(e,t)}},exports.AddresslistVotingClient=Gt,exports.Client=kt,exports.ClientCore=Ae,exports.Context=Be,exports.ContextPlugin=Ve,exports.EMPTY_PROPOSAL_METADATA_LINK=Ee,exports.LIVE_CONTRACTS=Re,exports.MultisigClient=Ar,exports.PermissionIds=Ye,exports.Permissions=je,exports.SubgraphVoteValuesMap=ie,exports.SupportedNetworksArray=de,exports.TokenVotingClient=cr,exports.UNAVAILABLE_PROPOSAL_METADATA=Se,exports.UNSUPPORTED_PROPOSAL_METADATA_LINK=ke,exports.computeProposalStatus=Me,exports.computeProposalStatusFilter=Fe,exports.decodeUpdatePluginSettingsAction=Ge,exports.encodeUpdateVotingSettingsAction=$e,exports.findLog=Le,exports.getFunctionFragment=We,exports.unwrapProposalParams=function(e){var t,r,n;return[e.metadataUri,null!=(t=e.actions)?t:[],e.startDate?Math.floor(e.startDate.getTime()/1e3):0,e.endDate?Math.floor(e.endDate.getTime()/1e3):0,null!=(r=e.executeOnPass)&&r,null!=(n=e.creatorVote)?n:exports.VoteValues.ABSTAIN]},exports.votingModeFromContracts=Ue,exports.votingModeToContracts=qe,exports.votingSettingsToContract=He;
//# sourceMappingURL=sdk-client.cjs.production.min.js.map
